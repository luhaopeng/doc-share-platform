"use strict";!function(){var l={format:"YYYY/MM/DD",separator:" - ",applyLabel:"应用",cancelLabel:"取消",fromLabel:"从",toLabel:"至",customRangeLabel:"自定义",weekLabel:"星期",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],firstDay:1};$(function(){$(".card .card-footer .stats").html('\n      <i class="material-icons">access_time</i>\n      统计时间：'.concat(moment().format("YYYY-MM-DD HH:mm:ss"),"\n    ")),$.post("main/queryBaseData",function(t){handleResult(t,function(t){var n=t.totalFile,a=t.totalDownload,e=t.totalEnterprise,o=t.totalCustomer,i=t.typeList,s=t.brandList,r=t.otherList;$("#docCount").html("".concat(n," <small>份</small>")),$("#saveCount").html("".concat(a," <small>次</small>")),$("#entCount").html("".concat(e," <small>家</small>")),$("#userCount").html("".concat(o," <small>人</small>")),function(t){var n=[],a=0,e=t.map(function(t){return n.push(t.name),a+=parseInt(t.typeNum),{meta:t.name,value:t.typeNum}});new Chartist.Pie("#chart_pie_1",{series:e},{height:"200px",labelOffset:15,showLabel:!1,plugins:[Chartist.plugins.legend({legendNames:n}),Chartist.plugins.tooltip({tooltipOffset:{x:14,y:-10}})]});var o="";t.map(function(t){o+="\n        ".concat(t.name,"\n        <span>\n          ").concat(parseInt(t.typeNum)/a*100|0,"%\n        </span>\n      ")}),$(".card p.chart-pie-1").html(o)}(i),function(t,n){var a=[],e=0,o=t.map(function(t){return a.push(t.name),e+=parseInt(t.typeNum),{meta:t.name,value:t.typeNum}});new Chartist.Pie("#chart_pie_2",{series:o},{height:"200px",labelOffset:15,showLabel:!1,plugins:[Chartist.plugins.legend({legendNames:a}),Chartist.plugins.tooltip({tooltipOffset:{x:14,y:-10}})]});var i,s,r="";t.map(function(t){"其他"!==t.name?r+="\n          ".concat(t.name,"\n          <span>\n            ").concat(parseInt(t.typeNum)/e*100|0,"%\n          </span>\n        "):(i=t.name,s=t.typeNum)});var l=$(".card p.chart-pie-2");if(l.html(r),n instanceof Array){var c='\n        <a\n          class="other"\n          tabindex="0"\n          title="其他"\n          data-trigger="hover"\n        >\n          '.concat(i,"\n          <span>\n            ").concat(parseInt(s)/e*100|0,"%\n          </span>\n        </a>\n      ");l.append(c);var p="";n.map(function(t){e+=t.typeNum}),n.map(function(t){p+="\n          ".concat(t.name,"\n          ").concat(parseInt(t.typeNum)/e*100|0,"%\n          <br />\n        ")}),l.find(".other").popover({html:!0,content:p})}}(s,r)})}),function(){var a="YYYY/MM/DD",e="YYYY-MM-DD",o={type:2,startDate:"",endDate:""};$("#switch_line").bootstrapSwitch({onText:"下载",offText:"上传",onColor:"info",offColor:"info",state:!0,size:"small",onSwitchChange:function(t,n){o.type=n?2:1,r(o)}});var i=new Chartist.Line("#chart_line",{},{plugins:[Chartist.plugins.ctPointLabels()]}),t=moment().startOf("month"),n=moment().endOf("month");function s(t,n){$("#range_line span").html(t.format(a)+" - "+n.format(a)),o.startDate=t.format(e),o.endDate=n.format(e),r(o)}function r(t){$.post("main/queryUpAndDownFile",t,function(t){handleResult(t,function(t){var n=t.valueList,a=t.dataTimeList;i.update({labels:a.map(function(t){return t.substr(8)}),series:[n.map(function(t){return parseInt(t)})]})})})}$("#range_line").daterangepicker({startDate:t,endDate:n,opens:"center",maxSpan:{days:31},locale:l,ranges:{"最近7天":[moment().subtract(6,"days"),moment()],"最近15天":[moment().subtract(14,"days"),moment()],"最近30天":[moment().subtract(29,"days"),moment()],"当月":[moment().startOf("month"),moment().endOf("month")],"上月":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]}},s),s(t,n)}(),function(){var n,a={fileType:2,circleType:3};function e(t){$.post("main/queryVerticalFile",t,function(t){handleResult(t,function(t){var e=[],o=[],i=[];t.dataList.map(function(n,t){var a=[];e.push(n.dataTime),n.fileCountList.map(function(t){o.length<n.fileCountList.length&&o.push(t.xdata),a.push(t.fileCount)}),i[t]=a}),n&&n.detach(),n=new Chartist.Bar("#chart_bar_1",{labels:o,series:i},{seriesBarDistance:10,plugins:[Chartist.plugins.legend({legendNames:e}),Chartist.plugins.tooltip({tooltipOffset:{x:14,y:-10}})]})})})}$("#switch_bar_1").bootstrapSwitch({onText:"下载量",offText:"上传量",onColor:"info",offColor:"info",state:!0,size:"small",onSwitchChange:function(t,n){a.fileType=n?2:1,e(a)}}),$("#switch_bar_option_1").bootstrapSwitch({onText:"按年",offText:"按月",onColor:"info",offColor:"info",state:!0,size:"mini",onSwitchChange:function(t,n){a.circleType=n?3:2,e(a)}}),e(a)}(),function(){var n,a={fileType:1,circleType:3,eid:1,compareEid:1};$("#switch_bar_option_2").bootstrapSwitch({onText:"按年",offText:"按月",onColor:"info",offColor:"info",state:!0,size:"mini",onSwitchChange:function(t,n){a.circleType=n?3:2,e(a)}});var t=$("#optionModal");function e(t){$.post("main/queryTransverseFile",t,function(t){handleResult(t,function(t){var e=[],o=[],i=[];t.dataList.map(function(n,t){var a=[];e.push(n.enterprise),n.fileCountList.map(function(t){o.length<n.fileCountList.length&&o.push(t.xdata),a.push(t.fileCount)}),i[t]=a}),n&&n.detach(),n=new Chartist.Bar("#chart_bar_2",{labels:o,series:i},{seriesBarDistance:10,plugins:[Chartist.plugins.legend({legendNames:e}),Chartist.plugins.tooltip({tooltipOffset:{x:14,y:-10}})]})})})}$("#btn_bar_option_2").on("click",function(){t.modal()}),t.on("click",".submit",function(){a.eid=parseInt(t.find("#ent1").val()),a.compareEid=parseInt(t.find("#ent2").val()),e(a),t.modal("hide")}),o=$("#optionModal #ent1, #optionModal #ent2"),$.post("main/queryAllEnt",function(t){handleResult(t,function(t){o.html(""),t.map(function(t){o.append('<option value="'.concat(t.id,'">').concat(t.name,"</option>"))}),a.eid=t[0].id,a.compareEid=t[t.length-1].id,e(a)})});var o}(),function(){var e={rankingType:1,rankingTimeType:1,sortType:"desc"},n=$("#table_rank"),o=n.find("a[data-rank]");o.on("click",function(){var t=$(this),n=t.data("rank");if("none"===n)o.data("rank","none").children("i").removeClass("rank-desc").removeClass("rank-asc"),t.data("rank","desc").children("i").addClass("rank-desc");else{var a="desc"===n?"asc":"desc";t.data("rank",a).children("i").removeClass("rank-"+n).addClass("rank-"+a)}e.rankingType=parseInt(t.data("type")),e.sortType=t.data("rank"),i(e)});var a=n.closest(".card").find("ul.nav-tabs");function i(t){var a=n.find("tbody");$.post("main/queryEnterpriseRanking",t,function(t){handleResult(t,function(t){a.html(""),t.map(function(t,n){a.append("\n              <tr>\n                <td>".concat(n+1,"</td>\n                <td>").concat(t.name,"</td>\n                <td>").concat(t.integralCount,"</td>\n                <td>").concat(t.fileUploadCount,"</td>\n                <td>").concat(t.fileDownloadedCount,"</td>\n              </tr>\n            "))})})})}a.on("click",".nav-link",function(){var t=$(this);t.hasClass("active")||(a.find(".nav-link").removeClass("active"),t.addClass("active"),e.rankingTimeType=parseInt(t.data("type")),i(e))}),i(e)}()})}();