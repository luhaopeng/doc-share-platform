"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var a=0,e=new Array(t.length);a<t.length;a++)e[a]=t[a];return e}}function ownKeys(a,t){var e,n=Object.keys(a);return Object.getOwnPropertySymbols&&(e=Object.getOwnPropertySymbols(a),t&&(e=e.filter(function(t){return Object.getOwnPropertyDescriptor(a,t).enumerable})),n.push.apply(n,e)),n}function _objectSpread(a){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(e,!0).forEach(function(t){_defineProperty(a,t,e[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(e)):ownKeys(e).forEach(function(t){Object.defineProperty(a,t,Object.getOwnPropertyDescriptor(e,t))})}return a}function _defineProperty(t,a,e){return a in t?Object.defineProperty(t,a,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[a]=e,t}!function(){var c={pageType:0,pageNum:1,pageSize:5,sortType:1,keyWord:"",classOne:0,classTwo:0,status:0,brands:[]};function l(t){var a="";t.options.map(function(t){a+='<li><a data-id="'.concat(t.id,'">').concat(t.label,"</a></li>")});return'\n      <div class="row" data-cat="'.concat(t.cat,'">\n        <div class="col-sm-2 key">\n          ').concat(t.catStr,'：\n        </div>\n        <ul class="col-sm-8 value">\n          ').concat(a,"\n        </ul>\n        ").concat(t.multi?'\n      <div class="col-sm-2 extra">\n        <a class="submit">提交</a>\n        <a class="cancel">取消</a>\n        <a class="multi">\n          <i class="material-icons">add</i>\n          多选\n        </a>\n      </div>\n    ':"","\n      </div>\n    ")}function d(t,a){var e;switch(t){case"brand":e="品牌";break;case"type":e="设备类型";break;case"subtype":e="设备次级类型";break;case"status":e="文件状态";break;default:e=""}var n=a;return 7<n.length&&(n=n.substr(0,7)+"..."),'\n      <a\n        class="factor"\n        title="'.concat(a,'"\n        data-cat="').concat(t,'"\n      >\n        <b>').concat(e,"：</b>\n        <em>").concat(n,'</em>\n        <i class="material-icons">close</i>\n      </a>\n    ')}function n(t){var a,e=t.state?'\n        <button\n          data-action="preview"\n          type="button"\n          class="btn btn-info"\n          title="预览"\n        >\n          <i class="material-icons">image</i>\n        </button>\n      ':t.stateStr,n="text-ellipsis";return t.unread&&(a=parseInt(t.id,10),!u().has(a))&&(n+=" unread"),'\n      <tr data-id="'.concat(t.id,'">\n        <td\n          class="text-left"\n          title="').concat(t.title,'"\n        >\n          <div class="').concat(n,'">').concat(t.title,"</div>\n        </td>\n        <td>").concat(t.date,"</td>\n        <td>").concat(t.size,"</td>\n        <td>").concat(t.cate,"</td>\n        <td>").concat(t.brand,'</td>\n        <td title="').concat(t.company,'">').concat(t.company.substr(0,6),"</td>\n        <td>").concat(t.bonus,'</td>\n        <td class="td-actions">').concat(e,'</td>\n        <td class="text-right">').concat(t.download,'</td>\n        <td class="td-actions text-right">\n          <button\n            data-action="star"\n            data-toggle="').concat(t.fav?"unstar":"star",'"\n            type="button"\n            class="btn btn-warning"\n            title="').concat(t.fav?"取消":"",'收藏"\n          >\n            <i class="material-icons">star').concat(t.fav?"":"_border",'</i>\n          </button>\n          <button\n            data-action="download"\n            type="button"\n            class="btn btn-success"\n            title="下载"\n          >\n            <i class="material-icons">get_app</i>\n          </button>\n        </td>\n      </tr>\n    ')}function u(){var t=JSON.parse(sessionStorage.readFileList);return new Set(t)}function f(t){var e=$("#table_origin tbody");$.post("fileData/queryFileData",t,function(t){handleResult(t,function(t){e.html("");var a=e.closest("table");a.siblings(".empty").remove(),0===t.list.length?$('<div class="empty">暂无数据</div>').insertAfter(a):t.list.map(function(t){e.append(n({id:t.fileDataId,title:t.fileName,date:t.dataTimeDesc,size:t.fileSizeDesc,cate:t.classTwoDesc,brand:t.brandDesc,company:t.enterprise,bonus:t.requiredIntegral,state:2===parseInt(t.fileDataStatus,10),stateStr:t.fileDataStatusDesc,download:t.downloadCount,fav:1===parseInt(t.favoriteStatus,10),unread:!!parseInt(t.flag,10)}))}),function(t){var a=$("#table_origin").siblings("nav").find("ul.pagination");a.find("li.page-item:not(.prev):not(.next)").remove();var e=a.find(".page-item.next"),n=t.pages,r=t.pageNum;if(n<=10)for(var i=1;i<=n;++i)$(o(i,r)).insertBefore(e);else r<=3?($(o(1,r)).insertBefore(e),$(o(2,r)).insertBefore(e),$(o(3,r)).insertBefore(e),$(o("...",r)).insertBefore(e)):n-2<=r?($(o(1,r)).insertBefore(e),$(o("...",r)).insertBefore(e),$(o(n-2,r)).insertBefore(e),$(o(n-1,r)).insertBefore(e)):($(o(1,r)).insertBefore(e),$(o("...",r)).insertBefore(e),$(o(r-1,r)).insertBefore(e),$(o(r,r)).insertBefore(e),$(o(r+1,r)).insertBefore(e),$(o("...",r)).insertBefore(e)),$(o(n,r)).insertBefore(e);function o(t,a){return'\n        <li class="page-item '.concat(a===t?"active":""," ").concat("..."===t?"else":"",'">\n          <a class="page-link">').concat(t,"</a>\n        </li>\n      ")}}({pageNum:t.pageNum,total:t.total,pages:t.pages})})})}function p(t){var a=$("base").attr("href")+"fileData/doFileDownload";$.fileDownload(a,{httpMethod:"POST",data:t})}function b(t,a){$.post("account/doFavorites",t,function(t){handleResult(t,a)})}sessionStorage.readFileList||(sessionStorage.readFileList=JSON.stringify([])),$(function(){var t,a,o,e,n,s;t=JSON.parse(filterObjStr),a=t.BRAND.map(function(t){return{id:t.value,label:t.name}}),o=t.CLASS_ONE.map(function(t){var a=t.childrens.map(function(t){return{id:t.value,label:t.name}});return{id:t.value,label:t.name,children:a}}),e=JSON.parse(filterStatusStr).map(function(t){return{id:t.value,label:t.name}}),n=$(".filter .combine"),(s=$(".filter .condition")).html("").append(l({cat:"brand",catStr:"品牌",options:a,multi:!0})).append(l({cat:"type",catStr:"设备类型",options:o,multi:!1})).append(l({cat:"status",catStr:"文件状态",options:e,multi:!1})),n.on("click",".factor",function(){var t=$(this),a=t.attr("data-cat");switch(s.children(".row[data-cat=".concat(a,"]")).show(),t.remove(),a){case"brand":c.brands=[];break;case"type":c.classOne=0,c.classTwo=0,t.siblings('[data-cat="subtype"]').remove(),s.find('[data-cat="subtype"]').remove();break;case"subtype":c.classTwo=0;break;case"status":c.status=0;break;default:return}f(c)}).on("click",".reset",function(){s.children(".row[data-cat]").show().filter('[data-cat="subtype"]').remove(),n.children(".factor").remove(),c.brands=[],c.classOne=0,c.classTwo=0,c.status=0,f(c)}),s.on("click",".row:not(.multi) .value a",function(){var t=$(this),a=t.closest(".row[data-cat]"),e=a.attr("data-cat"),n=t.text();switch($(d(e,n)).insertBefore(".filter .combine .reset"),a.hide(),e){case"brand":c.brands=[parseInt(t.attr("data-id"),10)];break;case"type":var r=parseInt(t.attr("data-id"),10);c.classOne=r;var i=o.find(function(t){return t.id===r});i.children.length&&s.append(l({cat:"subtype",catStr:"设备次级类型",options:i.children,multi:!1}));break;case"subtype":c.classTwo=parseInt(t.attr("data-id"),10);break;case"status":c.status=parseInt(t.attr("data-id"),10);break;default:return}f(c)}).on("click",".row.multi .value li",function(){$(this).closest("li").toggleClass("active")}).on("click",".extra .multi",function(){$(this).closest(".row[data-cat]").addClass("multi")}).on("click",".extra .submit",function(){var t=$(this).closest(".row.multi[data-cat]"),a=t.find(".value li.active"),e=t.attr("data-cat"),n="",r=[];a.text(function(t,a){n+=(t?",":"")+a;var e=$(this).find("a");r.push(parseInt(e.attr("data-id"),10))}),n&&($(d(e,n)).insertBefore(".filter .combine .reset"),t.hide(),c.brands=r,f(c)),t.removeClass("multi"),a.removeClass("active")}).on("click",".extra .cancel",function(){var t=$(this).closest(".row.multi[data-cat]"),a=t.find(".value li.active");t.removeClass("multi"),a.removeClass("active")}),function(){var t=$("#table_origin"),a=t.find("tbody");f(c);var e=t.find("a[data-rank]");e.on("click",function(){var t=$(this);"none"===t.attr("data-rank")&&(e.attr("data-rank","none").children("i").removeClass("rank-desc").removeClass("rank-asc"),t.attr("data-rank","desc").children("i").addClass("rank-desc"),c.sortType=t.attr("data-type"),f(c))});var n=t.siblings("nav");n.find(".limit select").on("change",function(t){c.pageNum=1,c.pageSize=parseInt(t.target.value,10),f(c)});var r=n.find("ul.pagination");r.on("click",".page-item",function(){var t=parseInt(r.find(".page-item:not(.prev):not(.next)").last().text(),10),a=$(this),e=c.pageNum;a.hasClass("prev")?c.pageNum=c.pageNum-1||1:a.hasClass("next")?c.pageNum=(c.pageNum+1)%(t+1)||t:a.hasClass("else")||(c.pageNum=parseInt(a.text(),10)||1),e!==c.pageNum&&f(c)}),t.closest(".card.result").siblings(".search").on("change",".search-box",function(){c.keyWord=$(this).val().trim()}).on("click",".search-btn",function(){f(c)}).on("keydown",".search-box",function(t){13==t.keyCode&&(c.keyWord=$(this).val().trim(),f(c))}),a.on("click","tr",function(t){var a,e,n,r,i,o=t.target.tagName;/tr|td|div/i.test(o)&&(e=(a=$(this).closest("tr")).attr("data-id"),n=$('\n          <form\n            action="fileData/fileDataDetail"\n            method="post"\n            target="_blank"\n            rel="noopener noreferrer"\n            style="display:none;"\n          >\n            <input name="fileDataId" value="'.concat(e,'" />\n          </form>\n        ')),a.find(".unread").removeClass("unread"),r=parseInt(e,10),(i=u()).add(r),function(t){sessionStorage.readFileList=JSON.stringify(_toConsumableArray(t))}(i),$(document.body).append(n),n.submit().remove())});var i=$("#downloadModal");i.on("hidden.bs.modal",function(){i.off("click","#downloadBtn")}),a.on("click","button[data-action=star]",function(){var t=$(this),a=t.closest("tr").attr("data-id"),e=t.attr("data-toggle"),n={icon:"success",position:"bottom-right",allowToastClose:!1,stack:!1,loader:!1,hideAfter:2e3,textAlign:"center"};$.toast().reset("all"),"star"===e?b({fileDataId:a,opsFavoritesType:1},function(){t.attr({"data-toggle":"unstar",title:"取消收藏"}).children(".material-icons").text("star"),$.toast(_objectSpread({heading:"收藏成功"},n))}):"unstar"===e&&b({fileDataId:a,opsFavoritesType:2},function(){t.attr({"data-toggle":"star",title:"收藏"}).children(".material-icons").text("star_border"),$.toast(_objectSpread({heading:"已取消收藏"},n))})}).on("click","button[data-action=download]",function(){var t,a,e={fileDataId:$(this).closest("tr").attr("data-id"),fileDataType:1};t=e,a=function(t){parseInt(t.requiredIntegral,10)?(i.find(".modal-body").html('\n              使用<b class="cost"> '.concat(t.requiredIntegral,' 积分</b>下载此文件？\n              当前积分余额：<b class="remain">').concat(t.currentIntegral," 积分</b>。\n            ")),i.modal(),i.on("click","#downloadBtn",function(){p(e),i.modal("hide")})):p(e)},$.post("fileData/checkFileDownload",t,function(t){handleResult(t,a)})}).on("click","button[data-action=preview]",function(){var t=$(this).closest("tr").attr("data-id"),a=$("base").attr("href"),e="".concat(a,"fileData/queryChartImg?fileDataId=").concat(t);window.open(e)})}()})}();