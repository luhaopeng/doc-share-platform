"use strict";function ownKeys(n,t){var e,a=Object.keys(n);return Object.getOwnPropertySymbols&&(e=Object.getOwnPropertySymbols(n),t&&(e=e.filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})),a.push.apply(a,e)),a}function _objectSpread(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(e,!0).forEach(function(t){_defineProperty(n,t,e[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):ownKeys(e).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))})}return n}function _defineProperty(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}!function(){var o={icon:"success",position:"bottom-right",allowToastClose:!1,stack:!1,loader:!1,hideAfter:2e3,textAlign:"center"};function t(a,t){var n=1<arguments.length&&void 0!==t?t:{},o={pageNum:1,pageSize:5,integralType:0},e=$(a),r=e.find("tbody");l(a,o,r);var i=e.find("a[data-rank]");i.on("click",function(){var t,n=$(this),e=n.attr("data-rank");"none"===e?(i.attr("data-rank","none").children("i").removeClass("rank-desc").removeClass("rank-asc"),n.attr("data-rank","desc").children("i").addClass("rank-desc")):(t="desc"===e?"asc":"desc",n.attr("data-rank",t).children("i").removeClass("rank-"+e).addClass("rank-"+t))});var c=e.siblings("nav");c.find(".limit select").on("change",function(t){o.pageNum=1,o.pageSize=parseInt(t.target.value,10),l(a,o,r)});var s=c.find("ul.pagination");if(s.on("click",".page-item",function(){var t=parseInt(s.find(".page-item:not(.prev):not(.next)").last().text(),10),n=$(this),e=o.pageNum;n.hasClass("prev")?o.pageNum=o.pageNum-1||1:n.hasClass("next")?o.pageNum=(o.pageNum+1)%(t+1)||t:n.hasClass("else")||(o.pageNum=parseInt(n.text(),10)||1),e!==o.pageNum&&l(a,o,r)}),/bonus/i.test(a)||r.on("click","tr",function(t){var n,e,a=t.target.tagName;/tr|td/i.test(a)&&(n=$(this).closest("tr").attr("data-id"),e=$('\n            <form\n              action="fileData/fileDataDetail"\n              method="post"\n              target="_blank"\n              rel="noopener noreferrer"\n              style="display:none;"\n            >\n              <input name="fileDataId" value="'.concat(n,'" />\n            </form>\n          ')),$(document.body).append(e),e.submit().remove())}),/star/i.test(a))for(var d in n)"function"==typeof n[d]&&r.on("click","button[data-action=".concat(d,"]"),n[d]);/bonus/i.test(a)&&e.find(".dropdown").on("click",".dropdown-item",function(){o.integralType=$(this).attr("data-type"),l(a,o,r)})}function l(n,t,e){e.html("");var a,o,r,i,c,s,d,l,u,f=e.closest("table");function p(t,n){0===t.length?$('<div class="empty">暂无数据</div>').insertAfter(f):t.map(function(t){return e.append(n(t))})}f.siblings(".empty").remove(),/upload/i.test(n)?(d=t,l=function(t){return p(t,g)},u=function(t){return v(n,t)},$.post("account/queryMyUploads",d,function(t){handleResult(t,function(t){var n={pageNum:t.pageNum,total:t.total,pages:t.pages},e=t.list.map(function(t){return{id:t.fileDataId,title:t.fileName,date:t.uploadTimeDesc,size:t.fileSizeDesc,cate:t.classTwoDesc,brand:t.brandDesc,state:t.fileDataStatusDesc,download:t.downloadCount}});"function"==typeof l&&l(e),"function"==typeof u&&u(n)})})):/star/i.test(n)?(i=t,c=function(t){return p(t,m)},s=function(t){return v(n,t)},$.post("account/queryMyFavorites",i,function(t){handleResult(t,function(t){var n={pageNum:t.pageNum,total:t.total,pages:t.pages},e=t.list.map(function(t){return{id:t.fileDataId,title:t.fileName,date:t.dataTimeDesc,size:t.fileSizeDesc,cate:t.classTwoDesc,brand:t.brandDesc,state:t.fileDataStatusDesc,bonus:t.requiredIntegral,download:t.downloadCount,fav:!0}});"function"==typeof c&&c(e),"function"==typeof s&&s(n)})})):/bonus/i.test(n)&&(a=t,o=function(t){return p(t,b)},r=function(t){return v(n,t)},$.post("account/queryMyIntegrals",a,function(t){handleResult(t,function(t){var n={pageNum:t.pageNum,total:t.total,pages:t.pages},e=t.list.map(function(t){return{time:t.addTimeDesc,type:t.integralTypeDesc,remark:t.description,bonus:t.integral,operand:1===parseInt(t.inOutType,10)?"+":"-"}});"function"==typeof o&&o(e),"function"==typeof r&&r(n)})}))}function g(t){return'\n      <tr data-id="'.concat(t.id,'">\n        <td\n          class="text-left"\n          title="').concat(t.title,'"\n        >\n          <div class="text-ellipsis">').concat(t.title,"</div>\n        </td>\n        <td>").concat(t.date,"</td>\n        <td>").concat(t.size,"</td>\n        <td>").concat(t.cate,"</td>\n        <td>").concat(t.brand,"</td>\n        <td>").concat(t.state,'</td>\n        <td class="text-right">').concat(t.download,"</td>\n      </tr>\n    ")}function m(t){return'\n      <tr data-id="'.concat(t.id,'">\n        <td\n          class="text-left"\n          title="').concat(t.title,'"\n        >\n          <div class="text-ellipsis">').concat(t.title,"</div>\n        </td>\n        <td>").concat(t.date,"</td>\n        <td>").concat(t.size,"</td>\n        <td>").concat(t.cate,"</td>\n        <td>").concat(t.brand,"</td>\n        <td>").concat(t.state,"</td>\n        <td>").concat(t.bonus,'</td>\n        <td class="text-right">').concat(t.download,'</td>\n        <td class="td-actions text-right">\n          <button\n            data-action="star"\n            data-toggle="').concat(t.fav?"unstar":"star",'"\n            type="button"\n            class="btn btn-warning"\n            title="').concat(t.fav?"取消":"",'收藏"\n          >\n            <i class="material-icons">star').concat(t.fav?"":"_border",'</i>\n          </button>\n          <button\n            data-action="download"\n            type="button"\n            class="btn btn-success"\n            title="下载"\n          >\n            <i class="material-icons">get_app</i>\n          </button>\n        </td>\n      </tr>\n    ')}function b(t){return"\n      <tr>\n        <td>".concat(t.time,"</td>\n        <td>").concat(t.type,"</td>\n        <td>").concat(t.remark,"</td>\n        <td>").concat(t.operand," ").concat(t.bonus,"</td>\n      </tr>\n    ")}function v(t,n){var e=$(t).siblings("nav").find("ul.pagination");e.find("li.page-item:not(.prev):not(.next)").remove();var a=e.find(".page-item.next"),o=n.pages,r=n.pageNum;if(o<=10)for(var i=1;i<=o;++i)$(c(i,r)).insertBefore(a);else r<=3?($(c(1,r)).insertBefore(a),$(c(2,r)).insertBefore(a),$(c(3,r)).insertBefore(a),$(c("...",r)).insertBefore(a)):o-2<=r?($(c(1,r)).insertBefore(a),$(c("...",r)).insertBefore(a),$(c(o-2,r)).insertBefore(a),$(c(o-1,r)).insertBefore(a)):($(c(1,r)).insertBefore(a),$(c("...",r)).insertBefore(a),$(c(r-1,r)).insertBefore(a),$(c(r,r)).insertBefore(a),$(c(r+1,r)).insertBefore(a),$(c("...",r)).insertBefore(a)),$(c(o,r)).insertBefore(a);function c(t,n){return'\n        <li class="page-item '.concat(n===t?"active":""," ").concat("..."===t?"else":"",'">\n          <a class="page-link">').concat(t,"</a>\n        </li>\n      ")}}function r(t){var n=$("base").attr("href")+"fileData/doFileDownload";$.fileDownload(n,{httpMethod:"POST",data:t})}function i(t,n){$.post("account/doFavorites",t,function(t){handleResult(t,n)})}$(function(){$('[data-toggle="popover"]').popover();var n,a=$("#downloadModal");a.on("hidden.bs.modal",function(){a.off("click","#downloadBtn")}),$.post("account/queryAccountInfo",function(t){handleResult(t,function(t){var n=t.account,e=t.enterprise,a=t.integral,o=t.uploadFileCount,r=t.beDownloadFileCount,i=$(".card.user"),c=i.find(".card-header");c.find("h3").text(n),c.find("h4").text(e);var s=i.find(".stats p");s.eq(0).text(a),s.eq(1).text(o),s.eq(2).text(r)})}),t("#table_upload"),t("#table_star",{star:function(){var t=$(this),n=t.closest("tr").attr("data-id"),e=t.attr("data-toggle");$.toast().reset("all"),"star"===e?i({fileDataId:n,opsFavoritesType:1},function(){t.attr({"data-toggle":"unstar",title:"取消收藏"}).children(".material-icons").text("star"),$.toast(_objectSpread({heading:"收藏成功"},o))}):"unstar"===e&&i({fileDataId:n,opsFavoritesType:2},function(){t.attr({"data-toggle":"star",title:"收藏"}).children(".material-icons").text("star_border"),$.toast(_objectSpread({heading:"已取消收藏"},o))})},download:function(){var t,n,e={fileDataId:$(this).closest("tr").attr("data-id"),fileDataType:1};t=e,n=function(t){parseInt(t.requiredIntegral,10)?(a.find(".modal-body").html('\n              使用<b class="cost"> '.concat(t.requiredIntegral,' 积分</b>下载此文件？\n              当前积分余额：<b class="remain">').concat(t.currentIntegral," 积分</b>。\n            ")),a.modal(),a.on("click","#downloadBtn",function(){r(e),a.modal("hide")})):r(e)},$.post("fileData/checkFileDownload",t,function(t){handleResult(t,n)})}}),t("#table_bonus"),(n=$("#table_bonus .dropdown .dropdown-menu")).html('\n      <a\n        tabindex="-1"\n        data-type="0"\n        class="dropdown-item"\n      >\n        全部类型\n      </a>\n      <div class="dropdown-divider"></div>\n    '),JSON.parse(bonusMenuStr).map(function(t){n.append('\n        <a\n          tabindex="-1"\n          data-type="'.concat(t.value,'"\n          class="dropdown-item"\n        >\n          ').concat(t.text,"\n        </a>\n      "))})})}();