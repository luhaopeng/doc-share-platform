"use strict";function _objectSpread(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{},a=Object.keys(e);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(e).filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.forEach(function(t){_defineProperty(n,t,e[t])})}return n}function _defineProperty(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}!function(){var i={icon:"success",position:"bottom-right",allowToastClose:!1,stack:!1,loader:!1,hideAfter:2e3,textAlign:"center"};function t(a){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o={pageNum:1,pageSize:5,integralType:0},n=$(a),i=n.find("tbody");d(a,o,i);var r=n.find("a[data-rank]");r.on("click",function(){var t=$(this),n=t.attr("data-rank");if("none"===n)r.attr("data-rank","none").children("i").removeClass("rank-desc").removeClass("rank-asc"),t.attr("data-rank","desc").children("i").addClass("rank-desc");else{var e="desc"===n?"asc":"desc";t.attr("data-rank",e).children("i").removeClass("rank-"+n).addClass("rank-"+e)}});var e=n.siblings("nav");e.find(".limit select").on("change",function(t){o.pageNum=1,o.pageSize=parseInt(t.target.value,10),d(a,o,i)});var c=e.find("ul.pagination");if(c.on("click",".page-item",function(){var t=parseInt(c.find(".page-item:not(.prev):not(.next)").last().text(),10),n=$(this),e=o.pageNum;n.hasClass("prev")?o.pageNum=o.pageNum-1||1:n.hasClass("next")?o.pageNum=(o.pageNum+1)%(t+1)||t:n.hasClass("else")||(o.pageNum=parseInt(n.text(),10)||1),e!==o.pageNum&&d(a,o,i)}),/bonus/i.test(a)||i.on("click","tr",function(t){var n=t.target.tagName;if(/tr|td/i.test(n)){var e=$(this).closest("tr"),a=e.attr("data-id"),o=e.attr("data-type"),i=$('\n            <form\n              action="fileData/fileDataDetail"\n              method="post"\n              target="_blank"\n              rel="noopener noreferrer"\n              style="display:none;"\n            >\n              <input name="fileDataId" value="'.concat(a,'" />\n              <input name="fileDataType" value="').concat(o,'" />\n            </form>\n          '));$(document.body).append(i),i.submit().remove()}}),/star/i.test(a))for(var s in t)"function"==typeof t[s]&&i.on("click","button[data-action=".concat(s,"]"),t[s]);/bonus/i.test(a)&&n.find(".dropdown").on("click",".dropdown-item",function(){o.integralType=$(this).attr("data-type"),d(a,o,i)})}function d(n,t,e){var a,c,s,o,d,l,i,u,p;function r(t,n){0===t.length?$('<div class="empty">暂无数据</div>').insertAfter(e.closest("table")):t.map(function(t){return e.append(n(t))})}/upload/i.test(n)?(e.html(""),i=t,u=function(t){return r(t,f)},p=function(t){return y(n,t)},$.post("account/queryMyUploads",i,function(t){handleResult(t,function(t){var n=t.pageNum,e=t.total,a=t.pages,o=t.list,i={pageNum:n,total:e,pages:a},r=o.map(function(t){return{id:t.fileDataId,title:t.fileName,date:t.uploadTimeDesc,size:t.fileSize+" MB",type:t.fileDataType,typeStr:t.fileDataTypeDesc,cate:t.classTwoDesc,brand:t.brandDesc,state:t.fileDataStatusDesc,download:t.downloadCount}});"function"==typeof u&&u(r),"function"==typeof p&&p(i)})})):/star/i.test(n)?(e.html(""),o=t,d=function(t){return r(t,g)},l=function(t){return y(n,t)},$.post("account/queryMyFavorites",o,function(t){handleResult(t,function(t){var n=t.pageNum,e=t.total,a=t.pages,o=t.list,i={pageNum:n,total:e,pages:a},r=o.map(function(t){return{id:t.fileDataId,title:t.fileName,date:t.dataTimeDesc,size:t.fileSize+" MB",type:t.fileDataType,typeStr:t.fileDataTypeDesc,cate:t.classTwoDesc,brand:t.brandDesc,state:t.fileDataStatusDesc,bonus:t.requiredIntegral,download:t.downloadCount,fav:!0}});"function"==typeof d&&d(r),"function"==typeof l&&l(i)})})):/bonus/i.test(n)&&(e.html(""),a=t,c=function(t){return r(t,m)},s=function(t){return y(n,t)},$.post("account/queryMyIntegrals",a,function(t){handleResult(t,function(t){var n=t.pageNum,e=t.total,a=t.pages,o=t.list,i={pageNum:n,total:e,pages:a},r=o.map(function(t){return{time:t.addTimeDesc,type:t.integralTypeDesc,remark:t.description,bonus:t.integral,operand:1===parseInt(t.inOutType,10)?"+":"-"}});"function"==typeof c&&c(r),"function"==typeof s&&s(i)})}))}function f(t){return'\n      <tr data-id="'.concat(t.id,'" data-type="').concat(t.type,'">\n        <td\n          class="text-left"\n          title="').concat(t.title,'"\n        >\n          <div class="text-ellipsis">').concat(t.title,"</div>\n        </td>\n        <td>").concat(t.date,"</td>\n        <td>").concat(t.size,"</td>\n        <td>").concat(t.typeStr,"</td>\n        <td>").concat(t.cate,"</td>\n        <td>").concat(t.brand,"</td>\n        <td>").concat(t.state,'</td>\n        <td class="text-right">').concat(t.download,"</td>\n      </tr>\n    ")}function g(t){return'\n      <tr data-id="'.concat(t.id,'" data-type="').concat(t.type,'">\n        <td\n          class="text-left"\n          title="').concat(t.title,'"\n        >\n          <div class="text-ellipsis">').concat(t.title,"</div>\n        </td>\n        <td>").concat(t.date,"</td>\n        <td>").concat(t.size,"</td>\n        <td>").concat(t.typeStr,"</td>\n        <td>").concat(t.cate,"</td>\n        <td>").concat(t.brand,"</td>\n        <td>").concat(t.state,"</td>\n        <td>").concat(t.bonus,'</td>\n        <td class="text-right">').concat(t.download,'</td>\n        <td class="td-actions text-right">\n          <button\n            data-action="star"\n            data-toggle="').concat(t.fav?"unstar":"star",'"\n            type="button"\n            class="btn btn-warning"\n            title="').concat(t.fav?"取消":"",'收藏"\n          >\n            <i class="material-icons">star').concat(t.fav?"":"_border",'</i>\n          </button>\n          <button\n            data-action="download"\n            type="button"\n            class="btn btn-success"\n            title="下载"\n          >\n            <i class="material-icons">get_app</i>\n          </button>\n        </td>\n      </tr>\n    ')}function m(t){return"\n      <tr>\n        <td>".concat(t.time,"</td>\n        <td>").concat(t.type,"</td>\n        <td>").concat(t.remark,"</td>\n        <td>").concat(t.operand," ").concat(t.bonus,"</td>\n      </tr>\n    ")}function y(t,n){var e=$(t).siblings("nav").find("ul.pagination");e.find("li.page-item:not(.prev):not(.next)").remove();var a=e.find(".page-item.next"),o=n.pages,i=n.pageNum;if(o<=10)for(var r=1;r<=o;++r)$(c(r,i)).insertBefore(a);else i<=3?($(c(1,i)).insertBefore(a),$(c(2,i)).insertBefore(a),$(c(3,i)).insertBefore(a),$(c("...",i)).insertBefore(a)):o-2<=i?($(c(1,i)).insertBefore(a),$(c("...",i)).insertBefore(a),$(c(o-2,i)).insertBefore(a),$(c(o-1,i)).insertBefore(a)):($(c(1,i)).insertBefore(a),$(c("...",i)).insertBefore(a),$(c(i-1,i)).insertBefore(a),$(c(i,i)).insertBefore(a),$(c(i+1,i)).insertBefore(a),$(c("...",i)).insertBefore(a)),$(c(o,i)).insertBefore(a);function c(t,n){return'\n        <li class="page-item '.concat(n===t?"active":""," ").concat("..."===t?"else":"",'">\n          <a class="page-link">').concat(t,"</a>\n        </li>\n      ")}}function r(t,n){$.post("account/doFavorites",t,function(t){handleResult(t,n)})}$(function(){var n;$('[data-toggle="popover"]').popover(),$.post("account/queryAccountInfo",function(t){handleResult(t,function(t){var n=t.account,e=t.enterprise,a=t.integral,o=t.uploadFileCount,i=t.beDownloadFileCount,r=$(".card.user"),c=r.find(".card-header");c.find("h3").text(n),c.find("h4").text(e);var s=r.find(".stats p");s.eq(0).text(a),s.eq(1).text(o),s.eq(2).text(i)})}),t("#table_upload"),t("#table_star",{star:function(){var t=$(this),n=t.closest("tr"),e=n.attr("data-id"),a=n.attr("data-type"),o=t.attr("data-toggle");$.toast().reset("all"),"star"===o?r({fileDataId:e,fileDataType:a,opsFavoritesType:1},function(){t.attr({"data-toggle":"unstar",title:"取消收藏"}).children(".material-icons").text("star"),$.toast(_objectSpread({heading:"收藏成功"},i))}):"unstar"===o&&r({fileDataId:e,fileDataType:a,opsFavoritesType:2},function(){t.attr({"data-toggle":"star",title:"收藏"}).children(".material-icons").text("star_border"),$.toast(_objectSpread({heading:"已取消收藏"},i))})},download:function(t){function n(){return t.apply(this,arguments)}return n.toString=function(){return t.toString()},n}(function(){var t,n,e=$(this).closest("tr"),a=e.attr("data-id"),o=e.attr("data-type"),i=$("#downloadModal");t={fileDataId:a,fileDataType:o},n=function(t){parseInt(t.requiredIntegral,10)?(i.find(".modal-body").html('\n              使用<b class="cost"> '.concat(t.requiredIntegral,' 积分</b>下载此文件？\n              当前积分余额：<b class="remain">').concat(t.currentIntegral," 积分</b>。\n            ")),i.modal(),i.on("click","#downloadBtn",function(){download({fileDataId:a,fileDataType:o}),i.modal("hide")})):download({fileDataId:a,fileDataType:o})},$.post("fileData/checkFileDownload",t,function(t){handleResult(t,n)})})}),t("#table_bonus"),(n=$("#table_bonus .dropdown .dropdown-menu")).html('\n      <a\n        tabindex="-1"\n        data-type="0"\n        class="dropdown-item"\n      >\n        全部类型\n      </a>\n      <div class="dropdown-divider"></div>\n    '),JSON.parse(bonusMenuStr).map(function(t){n.append('\n        <a\n          tabindex="-1"\n          data-type="'.concat(t.value,'"\n          class="dropdown-item"\n        >\n          ').concat(t.text,"\n        </a>\n      "))})})}();