"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var a=0,e=new Array(t.length);a<t.length;a++)e[a]=t[a];return e}}!function(){var o={pageType:1,pageNum:1,pageSize:5,sortType:1,keyWord:"",classOne:0,classTwo:0,status:0,releaseStatus:-1,checkStatus:-1,brands:[]};function l(t){var a="";t.options.map(function(t){a+='<li><a data-id="'.concat(t.id,'">').concat(t.label,"</a></li>")});return'\n      <div class="row" data-cat="'.concat(t.cat,'">\n        <div class="col-sm-2 key">\n          ').concat(t.catStr,'：\n        </div>\n        <ul class="col-sm-8 value">\n          ').concat(a,"\n        </ul>\n        ").concat(t.multi?'\n      <div class="col-sm-2 extra">\n        <a class="submit">提交</a>\n        <a class="cancel">取消</a>\n        <a class="multi">\n          <i class="material-icons">add</i>\n          多选\n        </a>\n      </div>\n    ':"","\n      </div>\n    ")}function d(t,a){var e;switch(t){case"brand":e="品牌";break;case"type":e="设备类型";break;case"subtype":e="设备次级类型";break;case"status":e="文件状态";break;case"inspect":e="检测状态";break;case"release":e="发布状态";break;default:e=""}var n=a;return 7<n.length&&(n=n.substr(0,7)+"..."),'\n      <a\n        class="factor"\n        title="'.concat(a,'"\n        data-cat="').concat(t,'"\n      >\n        <b>').concat(e,"：</b>\n        <em>").concat(n,'</em>\n        <i class="material-icons">close</i>\n      </a>\n    ')}function n(t){var a;a=t.state?'\n        <button\n          data-action="preview"\n          type="button"\n          class="btn btn-info"\n          title="预览"\n        >\n          <i class="material-icons">image</i>\n        </button>\n      ':t.stateStr;var e,n,r="text-ellipsis";t.unread&&(e=parseInt(t.id,10),!u().has(e))&&(r+=" unread");var c="";switch(t.inspect){case 1:n="text-warning";break;case 2:n="text-danger",c='\n          <span class="err-abbr" title="点击查看详情">\n            '.concat(t.inspectStr,"\n          </span>\n        ");break;case 3:n="text-success";break;default:n=""}return'\n      <tr data-id="'.concat(t.id,'">\n        <td>\n          <div class="form-check">\n            <label class="form-check-label">\n              <input class="form-check-input" type="checkbox" value="">\n              <span class="form-check-sign">\n                <span class="check"></span>\n              </span>\n            </label>\n          </div>\n        </td>\n        <td\n          class="text-left"\n          title="').concat(t.title,'"\n        >\n          <div class="').concat(r,'">').concat(t.title,"</div>\n        </td>\n        <td>").concat(t.date,"</td>\n        <td>").concat(t.size,"</td>\n        <td>").concat(t.cate,"</td>\n        <td>").concat(t.brand,'</td>\n        <td title="').concat(t.company,'">').concat(t.company.substr(0,4),"</td>\n        <td>").concat(t.bonus,'</td>\n        <td class="td-actions">').concat(a,'</td>\n        <td class="').concat(n,'">').concat(c||t.inspectStr,'</td>\n        <td class="').concat(t.release?"text-success":"",'">\n          ').concat(t.releaseStr,'\n        </td>\n        <td class="text-right">').concat(t.download,'</td>\n        <td class="td-actions text-right">\n          <button\n            data-action="download"\n            type="button"\n            class="btn btn-success"\n            title="下载"\n          >\n            <i class="material-icons">get_app</i>\n          </button>\n        </td>\n      </tr>\n    ')}function u(){var t=JSON.parse(sessionStorage.readFileList);return new Set(t)}function f(t){var a=$("#table_review"),e=a.find("tbody");a.find("thead .check-all .form-check-input").prop("checked",!1),$.post("fileData/queryFileData",t,function(t){handleResult(t,function(t){e.html("");var a=e.closest("table");a.siblings(".empty").remove(),0===t.list.length?$('<div class="empty">暂无数据</div>').insertAfter(a):t.list.map(function(t){e.append(n({id:t.fileDataId,title:t.fileName,date:t.dataTimeDesc,size:t.fileSizeDesc,cate:t.classTwoDesc,brand:t.brandDesc,company:t.enterprise,bonus:t.requiredIntegral,state:2===parseInt(t.fileDataStatus,10),stateStr:t.fileDataStatusDesc,download:t.downloadCount,releaseStr:t.releaseStatusDesc,release:t.releaseStatus,inspectStr:t.checkStatusDesc,inspect:t.checkStatus,unread:!!parseInt(t.flag,10)}))}),function(t){var a=$("#table_review").siblings("nav").find("ul.pagination");a.find("li.page-item:not(.prev):not(.next)").remove();var e=a.find(".page-item.next"),n=t.pages,r=t.pageNum;if(n<=10)for(var c=1;c<=n;++c)$(i(c,r)).insertBefore(e);else r<=3?($(i(1,r)).insertBefore(e),$(i(2,r)).insertBefore(e),$(i(3,r)).insertBefore(e),$(i("...",r)).insertBefore(e)):n-2<=r?($(i(1,r)).insertBefore(e),$(i("...",r)).insertBefore(e),$(i(n-2,r)).insertBefore(e),$(i(n-1,r)).insertBefore(e)):($(i(1,r)).insertBefore(e),$(i("...",r)).insertBefore(e),$(i(r-1,r)).insertBefore(e),$(i(r,r)).insertBefore(e),$(i(r+1,r)).insertBefore(e),$(i("...",r)).insertBefore(e)),$(i(n,r)).insertBefore(e);function i(t,a){return'\n        <li class="page-item '.concat(a===t?"active":""," ").concat("..."===t?"else":"",'">\n          <a class="page-link">').concat(t,"</a>\n        </li>\n      ")}}({pageNum:t.pageNum,total:t.total,pages:t.pages})})})}function p(t){var a=$("base").attr("href")+"fileData/doFileDownload";$.fileDownload(a,{httpMethod:"POST",data:t})}sessionStorage.readFileList||(sessionStorage.readFileList=JSON.stringify([])),$(function(){var t,a,i,e,n,r,c,s;t=JSON.parse(filterObjStr),a=t.BRAND.map(function(t){return{id:t.value,label:t.name}}),i=t.CLASS_ONE.map(function(t){var a=t.childrens.map(function(t){return{id:t.value,label:t.name}});return{id:t.value,label:t.name,children:a}}),e=JSON.parse(filterStatusStr).map(function(t){return{id:t.value,label:t.name}}),n=JSON.parse(filterInspectStr).map(function(t){return{id:t.value,label:t.name}}),r=JSON.parse(filterReleaseStr).map(function(t){return{id:t.value,label:t.name}}),c=$(".filter .combine"),(s=$(".filter .condition")).html("").append(l({cat:"brand",catStr:"品牌",options:a,multi:!0})).append(l({cat:"type",catStr:"设备类型",options:i,multi:!1})).append(l({cat:"status",catStr:"文件状态",options:e,multi:!1})).append(l({cat:"inspect",catStr:"检测状态",options:n,multi:!1})).append(l({cat:"release",catStr:"发布状态",options:r,multi:!1})),c.on("click",".factor",function(){var t=$(this),a=t.attr("data-cat");switch(s.children(".row[data-cat=".concat(a,"]")).show(),t.remove(),a){case"brand":o.brands=[];break;case"type":o.classOne=0,o.classTwo=0,t.siblings('[data-cat="subtype"]').remove(),s.find('[data-cat="subtype"]').remove();break;case"subtype":o.classTwo=0;break;case"status":o.status=0;break;case"inspect":o.checkStatus=-1;break;case"release":o.releaseStatus=-1;break;default:return}f(o)}).on("click",".reset",function(){s.children(".row[data-cat]").show().filter('[data-cat="subtype"]').remove(),c.children(".factor").remove(),o.brands=[],o.classOne=0,o.classTwo=0,o.status=0,o.checkStatus=-1,o.releaseStatus=-1,f(o)}),s.on("click",".row:not(.multi) .value a",function(){var t=$(this),a=t.closest(".row[data-cat]"),e=a.attr("data-cat"),n=t.text();switch($(d(e,n)).insertBefore(".filter .combine .reset"),a.hide(),e){case"brand":o.brands=[parseInt(t.attr("data-id"),10)];break;case"type":var r=parseInt(t.attr("data-id"),10);o.classOne=r;var c=i.find(function(t){return t.id===r});c.children.length&&s.append(l({cat:"subtype",catStr:"设备次级类型",options:c.children,multi:!1}));break;case"subtype":o.classTwo=parseInt(t.attr("data-id"),10);break;case"status":o.status=parseInt(t.attr("data-id"),10);break;case"inspect":o.checkStatus=parseInt(t.attr("data-id"),10);break;case"release":o.releaseStatus=parseInt(t.attr("data-id"),10);break;default:return}f(o)}).on("click",".row.multi .value li",function(){var t=$(this);t.closest("li").toggleClass("active")}).on("click",".extra .multi",function(){var t=$(this);t.closest(".row[data-cat]").addClass("multi")}).on("click",".extra .submit",function(){var t=$(this),a=t.closest(".row.multi[data-cat]"),e=a.find(".value li.active"),n=a.attr("data-cat"),r="",c=[];e.text(function(t,a){r+=(t?",":"")+a;var e=$(this).find("a");c.push(parseInt(e.attr("data-id"),10))}),r&&($(d(n,r)).insertBefore(".filter .combine .reset"),a.hide(),o.brands=c,f(o)),a.removeClass("multi"),e.removeClass("active")}).on("click",".extra .cancel",function(){var t=$(this),a=t.closest(".row.multi[data-cat]"),e=a.find(".value li.active");a.removeClass("multi"),e.removeClass("active")}),function(){var t=$("#table_review"),e=t.find("tbody");f(o);var n=t.find("a[data-rank]");n.on("click",function(){var t=$(this),a=t.attr("data-rank");"none"===a&&(n.attr("data-rank","none").children("i").removeClass("rank-desc").removeClass("rank-asc"),t.attr("data-rank","desc").children("i").addClass("rank-desc"),o.sortType=t.attr("data-type"),f(o))});var a=t.siblings("nav");a.find(".limit select").on("change",function(t){o.pageNum=1,o.pageSize=parseInt(t.target.value,10),f(o)});var r=a.find("ul.pagination");r.on("click",".page-item",function(){var t=parseInt(r.find(".page-item:not(.prev):not(.next)").last().text(),10),a=$(this),e=o.pageNum;a.hasClass("prev")?o.pageNum=o.pageNum-1||1:a.hasClass("next")?o.pageNum=(o.pageNum+1)%(t+1)||t:a.hasClass("else")||(o.pageNum=parseInt(a.text(),10)||1),e!==o.pageNum&&f(o)}),t.closest(".card.result").siblings(".search").on("change",".search-box",function(){o.keyWord=$(this).val().trim()}).on("click",".search-btn",function(){f(o)}).on("keydown",".search-box",function(t){13==t.keyCode&&(o.keyWord=$(this).val().trim(),f(o))}),e.on("click","tr",function(t){var a,e,n,r=t.target.tagName;if(/tr|td|div/i.test(r)){var c=$(this).closest("tr"),i=c.attr("data-id"),s=$('\n          <form\n            action="fileData/fileDataDetail"\n            method="post"\n            target="_blank"\n            rel="noopener noreferrer"\n            style="display:none;"\n          >\n            <input name="fileDataId" value="'.concat(i,'" />\n          </form>\n        '));c.find(".unread").removeClass("unread"),a=parseInt(i,10),(e=u()).add(a),n=e,sessionStorage.readFileList=JSON.stringify(_toConsumableArray(n)),$(document.body).append(s),s.submit().remove()}});var c=$("#downloadModal");c.on("hidden.bs.modal",function(){c.off("click","#downloadBtn")}),e.on("click","button[data-action=download]",function(){var t,a,e=$(this).closest("tr").attr("data-id"),n={fileDataId:e,fileDataType:1};t=n,a=function(t){parseInt(t.requiredIntegral,10)?(c.find(".modal-body").html('\n              使用<b class="cost"> '.concat(t.requiredIntegral,' 积分</b>下载此文件？\n              当前积分余额：<b class="remain">').concat(t.currentIntegral," 积分</b>。\n            ")),c.modal(),c.on("click","#downloadBtn",function(){p(n),c.modal("hide")})):p(n)},$.post("fileData/checkFileDownload",t,function(t){handleResult(t,a)})}).on("click","button[data-action=preview]",function(){var t=$(this).closest("tr").attr("data-id"),a=$("base").attr("href"),e="".concat(a,"fileData/queryChartImg?fileDataId=").concat(t);window.open(e)});var i=t.find("thead .check-all");i.on("change",".form-check-input",function(){e.find(".form-check-input").prop("checked",this.checked)}),e.on("change",".form-check-input",function(){var t=e.find(".form-check-input"),a=Array.from(t).every(function(t){return t.checked});i.find(".form-check-input").prop("checked",a)});var s=$("#batchModal");s.on("hidden.bs.modal",function(){s.off("click","#confirmBtn")}),$("#btn_inspect").on("click",function(){var t=e.find(".form-check-input:checked"),n=Array.from(t).map(function(t){return parseInt($(t).closest("tr").attr("data-id"),10)});n.length?(s.find(".modal-body .count").text("".concat(n.length," 个文件")),s.find(".modal-body .operation").text("检测"),s.modal(),s.on("click","#confirmBtn",function(){var t,a,e;s.modal("hide"),t={fileDataIds:n},a=function(){window.location.reload()},(e=$(document.body)).loading({message:"提交中..."}),$.post("fileData/doFileCheck",t,function(t){e.loading("stop"),handleResult(t,a)})})):toastErr({heading:"未选择文件"})}),$("#btn_release").on("click",function(){var t=e.find(".form-check-input:checked"),n=Array.from(t).map(function(t){return parseInt($(t).closest("tr").attr("data-id"),10)});n.length?(s.find(".modal-body .count").text("".concat(n.length," 个文件")),s.find(".modal-body .operation").text("发布"),s.modal(),s.on("click","#confirmBtn",function(){var t,a,e;s.modal("hide"),t={fileDataIds:n},a=function(){window.location.reload()},(e=$(document.body)).loading({message:"提交中..."}),$.post("fileData/doFileRelease",t,function(t){e.loading("stop"),handleResult(t,a)})})):toastErr({heading:"未选择文件"})}),e.on("click",".err-abbr",function(){var t,a=$(this).closest("tr").attr("data-id");t={fileDataId:a},$.post("fileData/queryFileCheckData",t,function(t){handleResult(t,function(t){var a=$("#errorModal"),e=a.find(".modal-body tbody");e.html("");var n=!0,r=!1,c=void 0;try{for(var i,s=t[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var o=i.value,l=o.conflictFileName,d=o.checkDesc,u=o.checkTime;e.append("\n            <tr>\n              <td>".concat(l,"</td>\n              <td>").concat(d,'</td>\n              <td class="text-center">').concat(u,"</td>\n            </tr>\n          "))}}catch(t){r=!0,c=t}finally{try{n||null==s.return||s.return()}finally{if(r)throw c}}a.modal()})})})}()})}();