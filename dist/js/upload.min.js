"use strict";!function(){var n,o=1;function r(){var e=$(".step.step-2 form");e.addClass("validate");var t=e.find(".form-control:invalid");return!(0<t.length)||(t.closest(".form-group").get(0).scrollIntoView({block:"start",behavior:"smooth"}),!1)}function e(){var e=$(".content"),t=$(".steps"),n=t.find(".steps-item-process").index();if(0<n){o--;var a=t.find(".steps-item");a.eq(n-1).removeClass("steps-item-finish").addClass("steps-item-process"),a.eq(n).removeClass("steps-item-process").addClass("steps-item-wait"),e.find(".step.step-".concat(o+1)).removeClass("current"),e.find(".step.step-".concat(o)).addClass("current"),e.find(".nav-action").removeClass("step-".concat(o+1)).addClass("step-".concat(o))}}function a(){var e=$(".content"),t=$(".steps"),n=t.find(".steps-item-process").index(),a=t.find(".steps-item");n<a.length-1&&(o++,a.eq(n+1).removeClass("steps-item-wait").addClass("steps-item-process"),a.eq(n).removeClass("steps-item-process").addClass("steps-item-finish"),e.find(".step.step-".concat(o-1)).removeClass("current"),e.find(".step.step-".concat(o)).addClass("current"),e.find(".nav-action").removeClass("step-".concat(o-1)).addClass("step-".concat(o)))}$(function(){!function(){var l,o=$("#uploadModal"),i=o.find(".progress .progress-bar"),e=o.find(".modal-header .modal-title"),s=o.find(".modal-body h4");WebUploader.Uploader.register({"before-send-file":function(a){var e,t,n,o,i=new $.Deferred;return e={md5:l},t=function(e){var t=e.status,n=e.data;1e3===t?(i.reject(),r()):(102===t&&(a.missChunks=n.missChunkList),i.resolve())},n=$(".step.step-2 form").get(0),o={fileName:n.docTitle.value,classOne:n.catLevel1.value,classTwo:n.catLevel2.value,brand:n.brand.value,model:n.model.value,modelAbbreviation:n.modelAbbr.value,standard:n.specs.value,ratedV:n.volSt.value,ratedI:n.curSt.value,ratedP:n.powSt.value,pattern:n.mode.value,equipment:n.collector.value,equipmentBrand:n.brandColl.value,equipmentModel:n.modelColl.value,samplingRate:n.rateColl.value,variableRatio:n.ratioColl.value,unitV:n.volUnit.value,unitI:n.curUnit.value,remark:n.note.value},$.post("fileData/checkFileUpload",Object.assign({},o,e),function(e){handleResult(e,t)}),$.when(i)},"before-send":function(e){var t=new $.Deferred,n=e.file,a=n.missChunks,o=e.chunk;return a&&!a.find(function(e){return o===e})?t.reject():t.resolve(),$.when(t)}});var t=$("base").attr("href")+"fileData/doFileUpload";(n=new WebUploader.Uploader({server:t,chunked:!0,fileSizeLimit:3221225472,fileSingleSizeLimit:3221225472,pick:{id:"#pickBtn",multiple:!1},formData:{md5:"",chunkSize:5242880},accept:{mimeTypes:"text/plain,application/matlab-mat"}})).on("beforeFileQueued",function(){n.reset(),i.width("0").text(""),e.text("检测文档"),s.text("文档检测中..."),o.modal()}).on("fileQueued",function(a){n.md5File(a,function(e){var t=(100*e).toFixed()+"%";i.width(t).text(t)}).then(function(e){var t,n;t={md5:l=e},n=function(e){i.width("100%").text("100%"),e.ret?s.text("文档已上传过，请更换"):(s.text("可以上传！"),$(".step-1 .cur-file").addClass("show").children("code").text(a.name),$("#navNext").removeAttr("disabled").removeAttr("title")),setTimeout(function(){o.modal("hide")},2e3)},$.post("fileData/checkFileMD5",t,n)})}).on("startUpload",function(){i.width("0").text(""),e.text("上传文档"),s.text("文档上传中..."),o.modal()}).on("uploadBeforeSend",function(e,t){t.md5=l}).on("uploadProgress",function(e,t){var n=(100*t).toFixed()+"%";i.width(n).text(n)}).on("uploadSuccess",function(){s.text("上传成功！"),setTimeout(function(){o.modal("hide"),a()},2e3)}).on("uploadError",function(){s.text("上传失败，请稍后重试"),setTimeout(function(){o.modal("hide")},2e3)})}(),$("#navPrev").on("click",e),$("#navNext").on("click",function(){1===o&&n&&0<n.getFiles().length&&a()}),$("#startUpload").on("click",function(){n.isInProgress()||r()&&n.upload()}),function(){var e=JSON.parse(filterObjStr),t=e.BRAND.map(function(e){return{id:e.value,label:e.name}}),n=e.CLASS_ONE.map(function(e){var t=e.childrens.map(function(e){return{id:e.value,label:e.name}});return{id:e.value,label:e.name,children:t}}),a=$("#catLevel1"),o=$("#catLevel2");a.html("<option value>请选择分类...</option>"),o.html("<option value>请选择一级分类...</option>"),n.map(function(e){a.append('\n        <option value="'.concat(e.id,'">').concat(e.label,"</option>\n      "))}),a.on("change",function(){o.html("");var t=$(this).val(),e=n.find(function(e){return e.id==t}).children;e.length&&e.map(function(e){o.append('<option value="'.concat(e.id,'">').concat(e.label,"</option>"))})});var i=$("#brand");i.html("<option value>请选择品牌...</option>"),t.map(function(e){i.append('\n        <option value="'.concat(e.id,'">').concat(e.label,"</option>\n      "))})}()})}();