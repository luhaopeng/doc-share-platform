"use strict";function _objectSpread(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{},a=Object.keys(e);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(e).filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.forEach(function(t){_defineProperty(n,t,e[t])})}return n}function _defineProperty(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}!function(){var o={icon:"success",position:"bottom-right",allowToastClose:!1,stack:!1,loader:!1,hideAfter:2e3,textAlign:"center"};function p(e){$.post("main/queryAllEnt",function(t){handleResult(t,function(t){var n=t.map(function(t){return t.name});$("#searchCompany").autocomplete({lookup:n,onSelect:e})})})}function t(a){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},l={pageNum:1,pageSize:5,keyword:"",entName:"",account:""};if(/user/i.test(a)){var s=$("#changeRoleModal");$("#users .search .add").on("click",function(){s.data("action","add"),s.find(".modal-title").text("新增用户"),s.find("input#user").prop("disabled",!1).val(""),s.find("select#role").get(0).selectedIndex=0,s.modal()}),s.on("click",".submit",function(){var t,n,e,a,o,i=s.find("#user").val().trim(),c=s.find("#role").val();"add"===s.data("action")?(e={account:i,roleId:c},a=s.find(".modal-body"),o=function(){m("#table_user",l,$("#table_user tbody")),s.modal("hide")},$.post("sys/doAddUser",e,function(t){t.ret?v(a,{className:"alert-warning",msg:t.msg}):"function"==typeof o&&o(t.data)})):"edit"===s.data("action")&&(t={account:i,roleId:c},n=function(){m("#table_user",l,$("#table_user tbody")),s.modal("hide")},$.post("sys/doUpdateUser",t,function(t){handleResult(t,n)}))})}else if(/role/i.test(a)){var d=$("#editRoleModal");$("#roles .search .add").on("click",function(){d.data("action","add"),d.find(".modal-title").text("新增角色"),d.find("input#name").val(""),d.find("input#desc").val(""),d.find(".form-check-input").prop("checked",!1),d.modal()}),d.on("click",".submit",function(){var t,n,e,a,o,i=d.find("#name").val().trim(),c=d.find("#desc").val().trim(),s=Array.from(d.find(".authority .form-check-input:checked")).map(function(t){return $(t).attr("data-id")});if("add"===d.data("action"))e={disc:i,remark:c,list:s},a=d.find(".modal-body"),o=function(){m("#table_role",l,$("#table_role tbody")),d.modal("hide")},$.post("sys/doAddRole",e,function(t){t.ret?v(a,{className:"alert-warning",msg:t.msg}):"function"==typeof o&&o(t.data)});else if("edit"===d.data("action")){var r=d.data("id");t={roleId:r,disc:i,remark:c,list:s},n=function(){m("#table_role",l,$("#table_role tbody")),d.modal("hide")},$.post("sys/doUpdateRole",t,function(t){handleResult(t,n)})}});var o=$("#deleteRoleModal");o.on("click",".submit",function(){var t,n,e=o.data("id");t={roleId:e},n=function(){m("#table_role",l,$("#table_role tbody")),o.modal("hide")},$.post("sys/doDeleteRole",t,function(t){handleResult(t,n)})})}var t=$(a),i=t.find("tbody");m(a,l,i);var e=t.siblings("nav");e.find(".limit select").on("change",function(t){l.pageNum=1,l.pageSize=parseInt(t.target.value,10),m(a,l,i)});var c=e.find("ul.pagination");c.on("click",".page-item",function(){var t=parseInt(c.find(".page-item:not(.prev):not(.next)").last().text(),10),n=$(this),e=l.pageNum;n.hasClass("prev")?l.pageNum=l.pageNum-1||1:n.hasClass("next")?l.pageNum=(l.pageNum+1)%(t+1)||t:n.hasClass("else")||(l.pageNum=parseInt(n.text(),10)||1),e!==l.pageNum&&m(a,l,i)}),p(function(){l.entName=$(this).val().trim()});var r=$(a).siblings(".search");/user/i.test(a)?r.on("change",".search-box",function(){l.keyword=$(this).val().trim()}):/role/i.test(a)?r.on("change",".search-box",function(){l.keyword=$(this).val().trim()}):/bonus/i.test(a)&&r.on("change",".search-box:first-child",function(){l.entName=$(this).val().trim()}).on("change",".search-box:nth-child(2)",function(){l.account=$(this).val().trim()}),r.on("click",".search-btn",function(){m(a,l,i)}).on("keydown",".search-box",function(t){if(13==t.keyCode){if(/bonus/i.test(a)){var n=$(this).index();l[n?"account":"entName"]=$(this).val().trim()}else l.keyword=$(this).val().trim();m(a,l,i)}});var u=function(t){"function"==typeof n[t]&&i.on("click","button[data-action=".concat(t,"]"),function(){n[t].call(this,l)})};for(var f in n)u(f)}function m(n,t,e){e.html("");var a,r,l,o,d,u,i,f,p,c=e.closest("table");function s(t,n){0===t.length?$('<div class="empty">暂无数据</div>').insertAfter(c):t.map(function(t){return e.append(n(t))})}c.siblings(".empty").remove(),/user/i.test(n)?(i=t,f=function(t){return s(t,b)},p=function(t){return h(n,t)},$.post("sys/queryUsers",i,function(t){handleResult(t,function(t){var n=t.pageNum,e=t.pageSize,a=t.total,o=t.pages,i=t.list,c={pageNum:n,pageSize:e,total:a,pages:o},s=i.map(function(t){return{account:t.account,company:t.enterprise,date:t.registerTimeStr,banned:!!(t.status-1),sys:2===t.type,type:t.typeStr,roleid:t.roleid,role:t.roleName}});"function"==typeof f&&f(s),"function"==typeof p&&p(c)})})):/role/i.test(n)?(o=t,d=function(t){return s(t,g)},u=function(t){return h(n,t)},$.post("sys/queryRoles",o,function(t){handleResult(t,function(t){var n=t.pageNum,e=t.pageSize,a=t.total,o=t.pages,i=t.list,c={pageNum:n,pageSize:e,total:a,pages:o},s=i.map(function(t){return{id:t.roleid,name:t.disc,desc:t.remark,creator:t.creator,time:t.createtime,disabled:!!parseInt(t.occupied,10)}});"function"==typeof d&&d(s),"function"==typeof u&&u(c)})})):/bonus/i.test(n)&&(a=t,r=function(t){return s(t,y)},l=function(t){return h(n,t)},$.post("sys/queryIntegralList",a,function(t){handleResult(t,function(t){var n=t.pageNum,e=t.pageSize,a=t.total,o=t.pages,i=t.list,c={pageNum:n,pageSize:e,total:a,pages:o},s=i.map(function(t){return{time:t.dataTimeStr,account:t.account,company:t.entName,type:t.typeStr,operand:1===parseInt(t.inOutType,10)?"+":"-",bonus:t.integral,total:t.currentIntegral}});"function"==typeof r&&r(s),"function"==typeof l&&l(c)})}))}function b(t){var n={ban:{toggle:"ban",color:"danger",title:"限制登录",icon:"not_interested"},recover:{toggle:"recover",color:"success",title:"恢复登录",icon:"replay"}}[t.banned?"recover":"ban"],e=n.toggle,a=n.color,o=n.title,i=n.icon,c='\n      <td class="td-actions">\n        <button\n          data-action="ban"\n          data-toggle="'.concat(e,'"\n          type="button"\n          class="btn btn-').concat(a,'"\n          title="').concat(o,'"\n        >\n          <i class="material-icons">').concat(i,'</i>\n        </button>\n        <button\n          data-action="edit"\n          type="button"\n          class="btn btn-info"\n          title="修改角色"\n        >\n          <i class="material-icons">edit</i>\n        </button>\n      </td>\n    ');return"\n      <tr data-account=".concat(t.account," data-role=").concat(t.roleid,">\n        <td>").concat(t.account,"</td>\n        <td>").concat(t.company,"</td>\n        <td>").concat(t.date,'</td>\n        <td class="').concat(t.banned?"text-warning":"",'">\n          ').concat(t.banned?"登录受限":"正常","\n        </td>\n        <td>").concat(t.type,"</td>\n        <td>").concat(t.role,"</td>\n        ").concat(t.sys?"<td>---</td>":c,"\n      </tr>\n    ")}function g(t){return"\n      <tr data-id=".concat(t.id,">\n        <td>").concat(t.name,"</td>\n        <td>").concat(t.desc,"</td>\n        <td>").concat(t.creator,"</td>\n        <td>").concat(t.time,'</td>\n        <td class="td-actions">\n          <button\n            data-action="edit"\n            type="button"\n            class="btn btn-info"\n            title="修改"\n          >\n            <i class="material-icons">edit</i>\n          </button>\n          <button\n            data-action="delete"\n            type="button"\n            class="btn btn-danger"\n            title="').concat(t.disabled?"角色已分配，无法删除":"删除",'"\n            ').concat(t.disabled?"disabled":"",'\n          >\n            <i class="material-icons">delete</i>\n          </button>\n        </td>\n      </tr>\n    ')}function y(t){return"\n      <tr>\n        <td>".concat(t.time,"</td>\n        <td>").concat(t.account,"</td>\n        <td>").concat(t.company,"</td>\n        <td>").concat(t.type,"</td>\n        <td>").concat(t.operand," ").concat(t.bonus,"</td>\n        <td>").concat(t.total,"</td>\n      </tr>\n    ")}function h(t,n){var e=$(t).siblings("nav").find("ul.pagination");e.find("li.page-item:not(.prev):not(.next)").remove();var a=e.find(".page-item.next"),o=n.pages,i=n.pageNum;if(o<=10)for(var c=1;c<=o;++c)$(s(c,i)).insertBefore(a);else i<=3?($(s(1,i)).insertBefore(a),$(s(2,i)).insertBefore(a),$(s(3,i)).insertBefore(a),$(s("...",i)).insertBefore(a)):o-2<=i?($(s(1,i)).insertBefore(a),$(s("...",i)).insertBefore(a),$(s(o-2,i)).insertBefore(a),$(s(o-1,i)).insertBefore(a)):($(s(1,i)).insertBefore(a),$(s("...",i)).insertBefore(a),$(s(i-1,i)).insertBefore(a),$(s(i,i)).insertBefore(a),$(s(i+1,i)).insertBefore(a),$(s("...",i)).insertBefore(a)),$(s(o,i)).insertBefore(a);function s(t,n){return'\n        <li class="page-item '.concat(n===t?"active":""," ").concat("..."===t?"else":"",'">\n          <a class="page-link">').concat(t,"</a>\n        </li>\n      ")}}function v(t,n){var e=t.find(".alert");e[0]?e.removeClass("alert-warning").removeClass("alert-success").addClass(n.className).show().find("span.msg").text(n.msg):t.prepend('\n        <div\n          class="alert '.concat(n.className,' alert-dismissible fade show"\n          role="alert"\n          style="display:block;"\n        >\n          <span class="msg">').concat(n.msg,'</span>\n          <button\n            type="button"\n            class="close"\n            style="top:9px;"\n            data-dismiss="alert"\n            aria-label="Close"\n          >\n            <span aria-hidden="true">&times;</span>\n          </button>\n        </div>\n     '))}function i(t,n){$.post("sys/doUpdateUserStatus",t,function(t){handleResult(t,n)})}$(function(){var e;$.post("sys/queryRoleList",function(t){handleResult(t,function(t){var n=$("#changeRoleModal select#role");n.html(""),t.map(function(t){n.append('\n            <option value="'.concat(t.roleid,'">').concat(t.disc,"</option>\n          "))})})}),e=$("#editRoleModal .authority"),$.post("sys/queryPermissions",function(t){handleResult(t,function(t){t.map(function(t){var n;e.append((n={id:t.moduleid,label:t.disc},'\n      <div class="form-check col-md-4">\n        <label class="form-check-label">\n          <input\n            class="form-check-input"\n            type="checkbox"\n            data-id="'.concat(n.id,'"\n          />\n          ').concat(n.label,'\n          <span class="form-check-sign">\n            <span class="check"></span>\n          </span>\n        </label>\n      </div>\n    ')))})})}),p(),t("#table_user",{ban:function(t){var n=$(this),e=n.closest("tr").attr("data-account"),a=n.attr("data-toggle");$.toast().reset("all"),"ban"===a?i({account:e,status:2},function(){n.attr({"data-toggle":"recover",title:"恢复登录"}).addClass("btn-success").removeClass("btn-danger").children(".material-icons").text("replay"),$.toast(_objectSpread({heading:"已禁用"},o)),m("#table_user",t,$("#table_user tbody"))}):"recover"===a&&i({account:e,status:1},function(){n.attr({"data-toggle":"ban",title:"限制登录"}).addClass("btn-danger").removeClass("btn-success").children(".material-icons").text("not_interested"),$.toast(_objectSpread({heading:"已恢复"},o)),m("#table_user",t,$("#table_user tbody"))})},edit:function(){var t=$(this).closest("tr"),n=t.attr("data-account"),e=t.attr("data-role"),a=$("#changeRoleModal");a.data("action","edit"),a.find(".modal-title").text("修改角色"),a.find("input#user").prop("disabled",!0).val(n),a.find("select#role").val(e),a.modal()}}),t("#table_role",{edit:function(){var t,n,e=$(this).closest("tr").attr("data-id"),a=$("#editRoleModal");a.data("action","edit"),a.find(".modal-title").text("修改角色"),t={roleId:e},n=function(t){a.data("id",e),a.find("input#name").val(t.disc),a.find("input#desc").val(t.remark),a.find(".form-check-input").prop("checked",!1),t.moduleIdList.map(function(t){a.find('.authority input[data-id="'.concat(t,'"]')).prop("checked",!0)}),a.modal()},$.post("sys/queryRoleDetail",t,function(t){handleResult(t,n)})},delete:function(){var t=$(this).closest("tr").attr("data-id");$("#deleteRoleModal").data("id",t).modal()}}),t("#table_bonus")})}();