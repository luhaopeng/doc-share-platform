"use strict";function _objectSpread(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{},a=Object.keys(e);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(e).filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.forEach(function(t){_defineProperty(n,t,e[t])})}return n}function _defineProperty(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}!function(){var a={icon:"success",position:"bottom-right",allowToastClose:!1,stack:!1,loader:!1,hideAfter:2e3,textAlign:"center"};function t(a){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o={pageNum:1,pageSize:5,keyword:"",disc:""},n=$(a),c=n.find("tbody");s(a,o,c);var e=n.siblings("nav");e.find(".limit select").on("change",function(t){var n=parseInt(t.target.value);o.pageSize=n,s(a,o,c)});var i=e.find("ul.pagination");i.on("click",".page-item",function(){var t=parseInt(i.find(".page-item:not(.prev):not(.next)").last().text()),n=$(this),e=o.pageNum;n.hasClass("prev")?o.pageNum=o.pageNum-1||1:n.hasClass("next")?o.pageNum=(o.pageNum+1)%(t+1)||t:n.hasClass("else")||(o.pageNum=parseInt(n.text())||1),e!==o.pageNum&&s(a,o,c)});var r=$(a).siblings(".search");for(var l in/user/i.test(a)?r.on("change",".search-box",function(){o.keyword=$(this).val().trim()}):/role/i.test(a)?r.on("change",".search-box",function(){o.disc=$(this).val().trim()}):/bonus/i.test(a),r.on("click",".search-btn",function(){s(a,o,c)}).on("keydown",".search-box",function(t){13==t.keyCode&&(o.keyword=$(this).val().trim(),s(a,o,c))}),t)"function"==typeof t[l]&&c.on("click","button[data-action=".concat(l,"]"),t[l])}function s(n,t,l){var e,a,o,s,d,c,u,p;/user/i.test(n)?(l.html(""),c=t,u=function(t){return t.map(function(t){return l.append((e={ban:{toggle:"ban",color:"danger",title:"限制登录",icon:"not_interested"},recover:{toggle:"recover",color:"success",title:"恢复登录",icon:"replay"}}[(n=t).banned?"recover":"ban"],a=e.toggle,o=e.color,c=e.title,i=e.icon,r='\n      <td class="td-actions">\n        <button\n          data-action="ban"\n          data-toggle="'.concat(a,'"\n          type="button"\n          class="btn btn-').concat(o,'"\n          title="').concat(c,'"\n        >\n          <i class="material-icons">').concat(i,'</i>\n        </button>\n        <button\n          data-action="edit"\n          type="button"\n          class="btn btn-info"\n          title="修改角色"\n        >\n          <i class="material-icons">edit</i>\n        </button>\n      </td>\n    '),"\n      <tr data-account=".concat(n.account," data-role=").concat(n.roleid,">\n        <td>").concat(n.account,"</td>\n        <td>").concat(n.company,"</td>\n        <td>").concat(n.date,'</td>\n        <td class="').concat(n.banned?"text-warning":"",'">\n          ').concat(n.banned?"登录受限":"正常","\n        </td>\n        <td>").concat(n.type,"</td>\n        <td>").concat(n.role,"</td>\n        ").concat(n.sys?"<td>---</td>":r,"\n      </tr>\n    ")));var n,e,a,o,c,i,r})},p=function(t){return i(n,t)},$.post("sys/queryUsers",c,function(t){handleResult(t,function(t){var n=t.pageNum,e=t.pageSize,a=t.total,o=t.pages,c=t.list,i={pageNum:n,pageSize:e,total:a,pages:o},r=c.map(function(t){return{account:t.account,company:t.enterprise,date:t.registerTimeStr,banned:!!(t.status-1),sys:2===t.type,type:t.typeStr,roleid:t.roleid,role:t.roleName}});"function"==typeof u&&u(r),"function"==typeof p&&p(i)})})):/role/i.test(n)?(l.html(""),o=t,s=function(t){return t.map(function(t){return l.append("\n      <tr data-id=".concat((n=t).id,">\n        <td>").concat(n.name,"</td>\n        <td>").concat(n.desc,"</td>\n        <td>").concat(n.creator,"</td>\n        <td>").concat(n.time,'</td>\n        <td class="td-actions">\n          <button\n            data-action="edit"\n            type="button"\n            class="btn btn-info"\n            title="修改"\n          >\n            <i class="material-icons">edit</i>\n          </button>\n          <button\n            data-action="delete"\n            type="button"\n            class="btn btn-danger"\n            title="删除"\n          >\n            <i class="material-icons">delete</i>\n          </button>\n        </td>\n      </tr>\n    '));var n})},d=function(t){return i(n,t)},$.post("sys/queryRoles",o,function(t){handleResult(t,function(t){var n=t.pageNum,e=t.pageSize,a=t.total,o=t.pages,c=t.list,i={pageNum:n,pageSize:e,total:a,pages:o},r=c.map(function(t){return{id:t.roleid,name:t.disc,desc:t.remark,creator:t.creator,time:t.createtime}});"function"==typeof s&&s(r),"function"==typeof d&&d(i)})})):/bonus/i.test(n)&&(l.html(""),e=function(t){return t.map(function(t){return l.append("\n      <tr>\n        <td>".concat((n=t).time,"</td>\n        <td>").concat(n.account,"</td>\n        <td>").concat(n.company,"</td>\n        <td>").concat(n.type,"</td>\n        <td>").concat(n.operand," ").concat(n.bonus,"</td>\n        <td>").concat(n.total,"</td>\n      </tr>\n    "));var n})},a=[1,2,3,4,5].map(function(){return _objectSpread({account:r(["admin","张腾","小张","张工"]),time:r(["2019-05-21 15:47:12","2019-05-21 12:30:13","2019-05-21 08:19:53"]),company:r(["华立科技股份有限公司","威盛集团有限公司","江苏林洋能源有限公司","深圳市科陆电子科技股份有限公司"])},r([{type:"文件上传",bonus:2,operand:"+"},{type:"文件被收藏",bonus:1,operand:"+"},{type:"下载文件",bonus:5,operand:"-"},{type:"文件入库",bonus:1,operand:"+"},{type:"评论文件",bonus:1,operand:"+"}]),{total:parseInt(200*Math.random())})}),"function"==typeof e&&e(a))}function i(t,n){var e=$(t).siblings("nav").find("ul.pagination");e.find("li.page-item:not(.prev):not(.next)").remove();var a=e.find(".page-item.next"),o=n.pages,c=n.pageNum;if(o<=10)for(var i=1;i<=o;++i)$(r(i,c)).insertBefore(a);else c<=3?($(r(1,c)).insertBefore(a),$(r(2,c)).insertBefore(a),$(r(3,c)).insertBefore(a),$(r("...",c)).insertBefore(a)):o-2<=c?($(r(1,c)).insertBefore(a),$(r("...",c)).insertBefore(a),$(r(o-2,c)).insertBefore(a),$(r(o-1,c)).insertBefore(a)):($(r(1,c)).insertBefore(a),$(r("...",c)).insertBefore(a),$(r(c-1,c)).insertBefore(a),$(r(c,c)).insertBefore(a),$(r(c+1,c)).insertBefore(a),$(r("...",c)).insertBefore(a)),$(r(o,c)).insertBefore(a);function r(t,n){return'\n        <li class="page-item '.concat(n===t?"active":""," ").concat("..."===t?"else":"",'">\n          <a class="page-link">').concat(t,"</a>\n        </li>\n      ")}}function r(t){return t[Math.random()*t.length|0]}$(function(){var e;$("#changeRoleModal .submit").on("click",function(){$("#changeRoleModal").modal("hide")}),$("#editRoleModal .submit").on("click",function(){$("#editRoleModal").modal("hide")}),$("#deleteRoleModal .submit").on("click",function(){$("#deleteRoleModal").modal("hide")}),$("#users .search .add").on("click",function(){var t=$("#changeRoleModal");t.find(".modal-title").text("新增用户"),t.find("input#user").prop("disabled",!1).val(""),t.find("select#role").get(0).selectedIndex=0,t.modal()}),$("#roles .search .add").on("click",function(){var t=$("#editRoleModal");t.find(".modal-title").text("新增角色"),t.find("input#name").val(""),t.find("select#rank").get(0).selectedIndex=0,t.find("input#desc").val(""),t.find(".form-check-input").prop("checked",!1),t.modal()}),$.post("sys/queryRoleList",function(t){handleResult(t,function(t){var n=$("#changeRoleModal select#role");n.html(""),t.map(function(t){n.append('\n            <option value="'.concat(t.roleid,'">').concat(t.disc,"</option>\n          "))})})}),e=$("#editRoleModal .authority"),[{name:"admin",label:"首页"},{name:"origin",label:"原始文件库"},{name:"parsed",label:"解析文件库"},{name:"account",label:"账号管理"}].map(function(t){return e.append('\n      <div class="form-check col-md-4">\n        <label class="form-check-label">\n          <input\n            class="form-check-input"\n            type="checkbox"\n            name="'.concat((n=t).name,'"\n          />\n          ').concat(n.label,'\n          <span class="form-check-sign">\n            <span class="check"></span>\n          </span>\n        </label>\n      </div>\n    '));var n}),$("#searchCompany").autocomplete({lookup:["华立科技股份有限公司","威盛集团有限公司","江苏林洋能源有限公司","深圳市科陆电子科技股份有限公司"]}),t("#table_user",{ban:function(){var t=$(this),n=t.attr("data-toggle");"ban"===n?(t.attr({"data-toggle":"recover",title:"恢复登录"}).addClass("btn-success").removeClass("btn-danger").children(".material-icons").text("replay"),$.toast(_objectSpread({heading:"已禁用"},a))):"recover"===n&&(t.attr({"data-toggle":"ban",title:"限制登录"}).addClass("btn-danger").removeClass("btn-success").children(".material-icons").text("not_interested"),$.toast(_objectSpread({heading:"已恢复"},a)))},edit:function(){var t=$(this).closest("tr"),n=t.attr("data-account"),e=t.attr("data-role"),a=$("#changeRoleModal");a.find(".modal-title").text("修改角色"),a.find("input#user").prop("disabled",!0).val(n),a.find("select#role").val(e),a.modal()}}),t("#table_role",{edit:function(){var t=$("#editRoleModal");t.find(".modal-title").text("修改角色"),t.find("input#name").val("企业用户"),t.find("select#rank").val("usr"),t.find("input#desc").val("普通用户"),t.modal(),t.find(".form-check-input").prop("checked",!1),t.find("input[name=origin], input[name=parsed]").prop("checked",!0),t.modal()},delete:function(){$("#deleteRoleModal").modal()}}),t("#table_bonus")})}();