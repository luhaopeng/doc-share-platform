"use strict";function _objectSpread(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{},a=Object.keys(e);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(e).filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.forEach(function(t){_defineProperty(n,t,e[t])})}return n}function _defineProperty(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}!function(){var a={icon:"success",position:"bottom-right",allowToastClose:!1,stack:!1,loader:!1,hideAfter:2e3,textAlign:"center"},d={pageNum:1,pageSize:5,keyword:"",entName:"",account:""};function t(a){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=$(a),o=n.find("tbody");u(a,d,o);var e=n.siblings("nav");e.find(".limit select").on("change",function(t){d.pageNum=1,d.pageSize=parseInt(t.target.value),u(a,d,o)});var i=e.find("ul.pagination");i.on("click",".page-item",function(){var t=parseInt(i.find(".page-item:not(.prev):not(.next)").last().text()),n=$(this),e=d.pageNum;n.hasClass("prev")?d.pageNum=d.pageNum-1||1:n.hasClass("next")?d.pageNum=(d.pageNum+1)%(t+1)||t:n.hasClass("else")||(d.pageNum=parseInt(n.text())||1),e!==d.pageNum&&u(a,d,o)});var c=$(a).siblings(".search");for(var s in/user/i.test(a)?c.on("change",".search-box",function(){d.keyword=$(this).val().trim()}):/role/i.test(a)?c.on("change",".search-box",function(){d.keyword=$(this).val().trim()}):/bonus/i.test(a)&&c.on("change",".search-box:first-child",function(){d.entName=$(this).val().trim()}).on("change",".search-box:nth-child(2)",function(){d.account=$(this).val().trim()}),c.on("click",".search-btn",function(){u(a,d,o)}).on("keydown",".search-box",function(t){if(13==t.keyCode){if(/bonus/i.test(a)){var n=$(this).index();d[n?"account":"entName"]=$(this).val().trim()}else d.keyword=$(this).val().trim();u(a,d,o)}}),t)"function"==typeof t[s]&&o.on("click","button[data-action=".concat(s,"]"),t[s])}function u(n,t,r){var e,l,d,a,u,p,o,f,m;/user/i.test(n)?(r.html(""),o=t,f=function(t){return t.map(function(t){return r.append((e={ban:{toggle:"ban",color:"danger",title:"限制登录",icon:"not_interested"},recover:{toggle:"recover",color:"success",title:"恢复登录",icon:"replay"}}[(n=t).banned?"recover":"ban"],a=e.toggle,o=e.color,i=e.title,c=e.icon,s='\n      <td class="td-actions">\n        <button\n          data-action="ban"\n          data-toggle="'.concat(a,'"\n          type="button"\n          class="btn btn-').concat(o,'"\n          title="').concat(i,'"\n        >\n          <i class="material-icons">').concat(c,'</i>\n        </button>\n        <button\n          data-action="edit"\n          type="button"\n          class="btn btn-info"\n          title="修改角色"\n        >\n          <i class="material-icons">edit</i>\n        </button>\n      </td>\n    '),"\n      <tr data-account=".concat(n.account," data-role=").concat(n.roleid,">\n        <td>").concat(n.account,"</td>\n        <td>").concat(n.company,"</td>\n        <td>").concat(n.date,'</td>\n        <td class="').concat(n.banned?"text-warning":"",'">\n          ').concat(n.banned?"登录受限":"正常","\n        </td>\n        <td>").concat(n.type,"</td>\n        <td>").concat(n.role,"</td>\n        ").concat(n.sys?"<td>---</td>":s,"\n      </tr>\n    ")));var n,e,a,o,i,c,s})},m=function(t){return i(n,t)},$.post("sys/queryUsers",o,function(t){handleResult(t,function(t){var n=t.pageNum,e=t.pageSize,a=t.total,o=t.pages,i=t.list,c={pageNum:n,pageSize:e,total:a,pages:o},s=i.map(function(t){return{account:t.account,company:t.enterprise,date:t.registerTimeStr,banned:!!(t.status-1),sys:2===t.type,type:t.typeStr,roleid:t.roleid,role:t.roleName}});"function"==typeof f&&f(s),"function"==typeof m&&m(c)})})):/role/i.test(n)?(r.html(""),a=t,u=function(t){return t.map(function(t){return r.append("\n      <tr data-id=".concat((n=t).id,">\n        <td>").concat(n.name,"</td>\n        <td>").concat(n.desc,"</td>\n        <td>").concat(n.creator,"</td>\n        <td>").concat(n.time,'</td>\n        <td class="td-actions">\n          <button\n            data-action="edit"\n            type="button"\n            class="btn btn-info"\n            title="修改"\n            ').concat(n.disabled?"disabled":"",'\n          >\n            <i class="material-icons">edit</i>\n          </button>\n          <button\n            data-action="delete"\n            type="button"\n            class="btn btn-danger"\n            title="删除"\n            ').concat(n.disabled?"disabled":"",'\n          >\n            <i class="material-icons">delete</i>\n          </button>\n        </td>\n      </tr>\n    '));var n})},p=function(t){return i(n,t)},$.post("sys/queryRoles",a,function(t){handleResult(t,function(t){var n=t.pageNum,e=t.pageSize,a=t.total,o=t.pages,i=t.list,c={pageNum:n,pageSize:e,total:a,pages:o},s=i.map(function(t){return{id:t.roleid,name:t.disc,desc:t.remark,creator:t.creator,time:t.createtime,disabled:!!parseInt(t.occupied)}});"function"==typeof u&&u(s),"function"==typeof p&&p(c)})})):/bonus/i.test(n)&&(r.html(""),e=t,l=function(t){return t.map(function(t){return r.append("\n      <tr>\n        <td>".concat((n=t).time,"</td>\n        <td>").concat(n.account,"</td>\n        <td>").concat(n.company,"</td>\n        <td>").concat(n.type,"</td>\n        <td>").concat(n.operand," ").concat(n.bonus,"</td>\n        <td>").concat(n.total,"</td>\n      </tr>\n    "));var n})},d=function(t){return i(n,t)},$.post("sys/queryIntegralList",e,function(t){handleResult(t,function(t){var n=t.pageNum,e=t.pageSize,a=t.total,o=t.pages,i=t.list,c={pageNum:n,pageSize:e,total:a,pages:o},s=i.map(function(t){return{time:t.dataTimeStr,account:t.account,company:t.entName,type:t.typeStr,operand:1===parseInt(t.inOutType)?"+":"-",bonus:t.integral,total:t.currentIntegral}});"function"==typeof l&&l(s),"function"==typeof d&&d(c)})}))}function i(t,n){var e=$(t).siblings("nav").find("ul.pagination");e.find("li.page-item:not(.prev):not(.next)").remove();var a=e.find(".page-item.next"),o=n.pages,i=n.pageNum;if(o<=10)for(var c=1;c<=o;++c)$(s(c,i)).insertBefore(a);else i<=3?($(s(1,i)).insertBefore(a),$(s(2,i)).insertBefore(a),$(s(3,i)).insertBefore(a),$(s("...",i)).insertBefore(a)):o-2<=i?($(s(1,i)).insertBefore(a),$(s("...",i)).insertBefore(a),$(s(o-2,i)).insertBefore(a),$(s(o-1,i)).insertBefore(a)):($(s(1,i)).insertBefore(a),$(s("...",i)).insertBefore(a),$(s(i-1,i)).insertBefore(a),$(s(i,i)).insertBefore(a),$(s(i+1,i)).insertBefore(a),$(s("...",i)).insertBefore(a)),$(s(o,i)).insertBefore(a);function s(t,n){return'\n        <li class="page-item '.concat(n===t?"active":""," ").concat("..."===t?"else":"",'">\n          <a class="page-link">').concat(t,"</a>\n        </li>\n      ")}}function p(t,n){var e=t.find(".alert");e[0]?e.removeClass("alert-warning").removeClass("alert-success").addClass(n.className).show().find("span.msg").text(n.msg):t.prepend('\n        <div\n          class="alert '.concat(n.className,' alert-dismissible fade show"\n          role="alert"\n          style="display:block;"\n        >\n          <span class="msg">').concat(n.msg,'</span>\n          <button\n            type="button"\n            class="close"\n            style="top:9px;"\n            data-dismiss="alert"\n            aria-label="Close"\n          >\n            <span aria-hidden="true">&times;</span>\n          </button>\n        </div>\n     '))}function o(t,n){$.post("sys/doUpdateUserStatus",t,function(t){handleResult(t,n)})}$(function(){var e;!function(){var s=$("#changeRoleModal");s.on("click",".submit",function(){var t,n,e,a,o,i=s.find("#user").val().trim(),c=s.find("#role").val();"add"===s.data("action")?(e={account:i,roleId:c},a=s.find(".modal-body"),o=function(){u("#table_user",d,$("#table_user tbody")),s.modal("hide")},$.post("sys/doAddUser",e,function(t){t.ret?p(a,{className:"alert-warning",msg:t.msg}):"function"==typeof o&&o(t.data)})):"edit"===s.data("action")&&(t={account:i,roleId:c},n=function(){u("#table_user",d,$("#table_user tbody")),s.modal("hide")},$.post("sys/doUpdateUser",t,function(t){handleResult(t,n)}))});var l=$("#editRoleModal");l.on("click",".submit",function(){var t,n,e,a,o,i=l.find("#name").val().trim(),c=l.find("#desc").val().trim(),s=Array.from(l.find(".authority .form-check-input:checked")).map(function(t){return $(t).attr("data-id")});if("add"===l.data("action"))e={disc:i,remark:c,list:s},a=l.find(".modal-body"),o=function(){u("#table_role",d,$("#table_role tbody")),l.modal("hide")},$.post("sys/doAddRole",e,function(t){t.ret?p(a,{className:"alert-warning",msg:t.msg}):"function"==typeof o&&o(t.data)});else if("edit"===l.data("action")){var r=l.data("id");t={roleId:r,disc:i,remark:c,list:s},n=function(){u("#table_role",d,$("#table_role tbody")),l.modal("hide")},$.post("sys/doUpdateRole",t,function(t){handleResult(t,n)})}});var a=$("#deleteRoleModal");a.on("click",".submit",function(){var t,n,e=a.data("id");t={roleId:e},n=function(){u("#table_role",d,$("#table_role tbody")),a.modal("hide")},$.post("sys/doDeleteRole",t,function(t){handleResult(t,n)})}),$("#users .search .add").on("click",function(){var t=$("#changeRoleModal");t.data("action","add"),t.find(".modal-title").text("新增用户"),t.find("input#user").prop("disabled",!1).val(""),t.find("select#role").get(0).selectedIndex=0,t.modal()}),$("#roles .search .add").on("click",function(){var t=$("#editRoleModal");t.data("action","add"),t.find(".modal-title").text("新增角色"),t.find("input#name").val(""),t.find("input#desc").val(""),t.find(".form-check-input").prop("checked",!1),t.modal()})}(),$.post("sys/queryRoleList",function(t){handleResult(t,function(t){var n=$("#changeRoleModal select#role");n.html(""),t.map(function(t){n.append('\n            <option value="'.concat(t.roleid,'">').concat(t.disc,"</option>\n          "))})})}),e=$("#editRoleModal .authority"),$.post("sys/queryPermissions",function(t){handleResult(t,function(t){t.map(function(t){var n;e.append((n={id:t.moduleid,label:t.disc},'\n      <div class="form-check col-md-4">\n        <label class="form-check-label">\n          <input\n            class="form-check-input"\n            type="checkbox"\n            data-id="'.concat(n.id,'"\n          />\n          ').concat(n.label,'\n          <span class="form-check-sign">\n            <span class="check"></span>\n          </span>\n        </label>\n      </div>\n    ')))})})}),$.post("main/queryAllEnt",function(t){handleResult(t,function(t){var n=t.map(function(t){return t.name});$("#searchCompany").autocomplete({lookup:n,onSelect:function(){d.entName=$(this).val().trim()}})})}),t("#table_user",{ban:function(){var t=$(this),n=t.closest("tr").attr("data-account"),e=t.attr("data-toggle");$.toast().reset("all"),"ban"===e?o({account:n,status:2},function(){t.attr({"data-toggle":"recover",title:"恢复登录"}).addClass("btn-success").removeClass("btn-danger").children(".material-icons").text("replay"),$.toast(_objectSpread({heading:"已禁用"},a)),u("#table_user",d,$("#table_user tbody"))}):"recover"===e&&o({account:n,status:1},function(){t.attr({"data-toggle":"ban",title:"限制登录"}).addClass("btn-danger").removeClass("btn-success").children(".material-icons").text("not_interested"),$.toast(_objectSpread({heading:"已恢复"},a)),u("#table_user",d,$("#table_user tbody"))})},edit:function(){var t=$(this).closest("tr"),n=t.attr("data-account"),e=t.attr("data-role"),a=$("#changeRoleModal");a.data("action","edit"),a.find(".modal-title").text("修改角色"),a.find("input#user").prop("disabled",!0).val(n),a.find("select#role").val(e),a.modal()}}),t("#table_role",{edit:function(){var t,n,e=$(this).closest("tr").attr("data-id"),a=$("#editRoleModal");a.data("action","edit"),a.find(".modal-title").text("修改角色"),t={roleId:e},n=function(t){a.data("id",e),a.find("input#name").val(t.disc),a.find("input#desc").val(t.remark),a.find(".form-check-input").prop("checked",!1),t.moduleIdList.map(function(t){a.find('.authority input[data-id="'.concat(t,'"]')).prop("checked",!0)}),a.modal()},$.post("sys/queryRoleDetail",t,function(t){handleResult(t,n)})},delete:function(){var t=$(this).closest("tr").attr("data-id");$("#deleteRoleModal").data("id",t).modal()}}),t("#table_bonus")})}();