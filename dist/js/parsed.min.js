"use strict";function ownKeys(a,t){var e,n=Object.keys(a);return Object.getOwnPropertySymbols&&(e=Object.getOwnPropertySymbols(a),t&&(e=e.filter(function(t){return Object.getOwnPropertyDescriptor(a,t).enumerable})),n.push.apply(n,e)),n}function _objectSpread(a){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(e,!0).forEach(function(t){_defineProperty(a,t,e[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(e)):ownKeys(e).forEach(function(t){Object.defineProperty(a,t,Object.getOwnPropertyDescriptor(e,t))})}return a}function _defineProperty(t,a,e){return a in t?Object.defineProperty(t,a,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[a]=e,t}!function(){var s={pageNum:1,pageSize:5,fileDataType:2,sortType:1,keyWord:"",classOne:0,classTwo:0,brands:[]};function l(t){var a="";t.options.map(function(t){a+='<li><a data-id="'.concat(t.id,'">').concat(t.label,"</a></li>")});return'\n      <div class="row" data-cat="'.concat(t.cat,'">\n        <div class="col-sm-2 key">\n          ').concat(t.catStr,'：\n        </div>\n        <ul class="col-sm-8 value">\n          ').concat(a,"\n        </ul>\n        ").concat(t.multi?'\n      <div class="col-sm-2 extra">\n        <a class="submit">提交</a>\n        <a class="cancel">取消</a>\n        <a class="multi">\n          <i class="material-icons">add</i>\n          多选\n        </a>\n      </div>\n    ':"","\n      </div>\n    ")}function d(t,a){var e;switch(t){case"brand":e="品牌";break;case"type":e="设备类型";break;case"subtype":e="设备次级类型";break;default:e=""}var n=a;return 7<n.length&&(n=n.substr(0,7)+"..."),'\n      <a\n        class="factor"\n        title="'.concat(a,'"\n        data-cat="').concat(t,'"\n      >\n        <b>').concat(e,"：</b>\n        <em>").concat(n,'</em>\n        <i class="material-icons">close</i>\n      </a>\n    ')}function u(t){var e=$("#table_parsed tbody");$.post("fileData/queryFileData",t,function(t){handleResult(t,function(t){e.html("");var a=e.closest("table");a.siblings(".empty").remove(),0===t.list.length?$('<div class="empty">暂无数据</div>').insertAfter(a):t.list.map(function(t){var a;e.append((a={id:t.fileDataId,title:t.fileName,date:t.dataTimeDesc,size:t.fileSizeDesc,type:t.fileDataTypeDesc,cate:t.classTwoDesc,brand:t.brandDesc,company:t.enterprise,bonus:parseInt(t.requiredIntegral,10),download:t.downloadCount,fav:1===parseInt(t.favoriteStatus,10)},'\n      <tr data-id="'.concat(a.id,'">\n        <td\n          class="text-left"\n          title="').concat(a.title,'"\n        >\n          <div class="text-ellipsis">').concat(a.title,"</div>\n        </td>\n        <td>").concat(a.date,"</td>\n        <td>").concat(a.size,"</td>\n        <td>").concat(a.type,"</td>\n        <td>").concat(a.cate,"</td>\n        <td>").concat(a.brand,'</td>\n        <td title="').concat(a.company,'">').concat(a.company.substr(0,6),"</td>\n        <td>").concat(a.bonus,'</td>\n        <td class="text-right">').concat(a.download,'</td>\n        <td class="td-actions text-right">\n          <button\n            data-action="star"\n            data-toggle="').concat(a.fav?"unstar":"star",'"\n            type="button"\n            class="btn btn-warning"\n            title="').concat(a.fav?"取消":"",'收藏"\n          >\n            <i class="material-icons">star').concat(a.fav?"":"_border",'</i>\n          </button>\n          <button\n            data-action="download"\n            type="button"\n            class="btn btn-success"\n            title="下载"\n          >\n            <i class="material-icons">get_app</i>\n          </button>\n        </td>\n      </tr>\n    ')))}),function(t){var a=$("#table_parsed").siblings("nav").find("ul.pagination");a.find("li.page-item:not(.prev):not(.next)").remove();var e=a.find(".page-item.next"),n=t.pages,r=t.pageNum;if(n<=10)for(var i=1;i<=n;++i)$(o(i,r)).insertBefore(e);else r<=3?($(o(1,r)).insertBefore(e),$(o(2,r)).insertBefore(e),$(o(3,r)).insertBefore(e),$(o("...",r)).insertBefore(e)):n-2<=r?($(o(1,r)).insertBefore(e),$(o("...",r)).insertBefore(e),$(o(n-2,r)).insertBefore(e),$(o(n-1,r)).insertBefore(e)):($(o(1,r)).insertBefore(e),$(o("...",r)).insertBefore(e),$(o(r-1,r)).insertBefore(e),$(o(r,r)).insertBefore(e),$(o(r+1,r)).insertBefore(e),$(o("...",r)).insertBefore(e)),$(o(n,r)).insertBefore(e);function o(t,a){return'\n        <li class="page-item '.concat(a===t?"active":""," ").concat("..."===t?"else":"",'">\n          <a class="page-link">').concat(t,"</a>\n        </li>\n      ")}}({pageNum:t.pageNum,total:t.total,pages:t.pages})})})}function i(t){var a=$("base").attr("href")+"fileData/doFileDownload";$.fileDownload(a,{httpMethod:"POST",data:t})}function f(t,a){$.post("account/doFavorites",t,function(t){handleResult(t,a)})}$(function(){var t,a,o,e,c;t=JSON.parse(filterObjStr),a=t.BRAND.map(function(t){return{id:t.value,label:t.name}}),o=t.CLASS_ONE.map(function(t){var a=t.childrens.map(function(t){return{id:t.value,label:t.name}});return{id:t.value,label:t.name,children:a}}),e=$(".filter .combine"),(c=$(".filter .condition")).html("").append(l({cat:"brand",catStr:"品牌",options:a,multi:!0})).append(l({cat:"type",catStr:"设备类型",options:o,multi:!1})),e.on("click",".factor",function(){var t=$(this),a=t.attr("data-cat");switch(c.children(".row[data-cat=".concat(a,"]")).show(),t.remove(),a){case"brand":s.brands=[];break;case"type":s.classOne=0,s.classTwo=0,t.siblings('[data-cat="subtype"]').remove(),c.find('[data-cat="subtype"]').remove();break;case"subtype":s.classTwo=0;break;default:return}u(s)}).on("click",".reset",function(){c.children(".row[data-cat]").show().filter('[data-cat="subtype"]').remove(),e.children(".factor").remove(),s.brands=[],s.classOne=0,s.classTwo=0,u(s)}),c.on("click",".row:not(.multi) .value a",function(){var t=$(this),a=t.closest(".row[data-cat]"),e=a.attr("data-cat"),n=t.text();switch($(d(e,n)).insertBefore(".filter .combine .reset"),a.hide(),e){case"brand":s.brands=[parseInt(t.attr("data-id"),10)];break;case"type":var r=parseInt(t.attr("data-id"),10);s.classOne=r;var i=o.find(function(t){return t.id===r});i.children.length&&c.append(l({cat:"subtype",catStr:"设备次级类型",options:i.children,multi:!1}));break;case"subtype":s.classTwo=parseInt(t.attr("data-id"),10);break;default:return}u(s)}).on("click",".row.multi .value li",function(){$(this).closest("li").toggleClass("active")}).on("click",".extra .multi",function(){$(this).closest(".row[data-cat]").addClass("multi")}).on("click",".extra .submit",function(){var t=$(this).closest(".row.multi[data-cat]"),a=t.find(".value li.active"),e=t.attr("data-cat"),n="",r=[];a.text(function(t,a){n+=(t?",":"")+a;var e=$(this).find("a");r.push(parseInt(e.attr("data-id"),10))}),n&&($(d(e,n)).insertBefore(".filter .combine .reset"),t.hide(),s.brands=r,u(s)),t.removeClass("multi"),a.removeClass("active")}).on("click",".extra .cancel",function(){var t=$(this).closest(".row.multi[data-cat]"),a=t.find(".value li.active");t.removeClass("multi"),a.removeClass("active")}),function(){var t=$("#table_parsed"),a=t.find("tbody");u(s);var e=t.find("a[data-rank]");e.on("click",function(){var t=$(this);"none"===t.attr("data-rank")&&(e.attr("data-rank","none").children("i").removeClass("rank-desc").removeClass("rank-asc"),t.attr("data-rank","desc").children("i").addClass("rank-desc"),s.sortType=t.attr("data-type"),u(s))});var n=t.siblings("nav");n.find(".limit select").on("change",function(t){s.pageNum=1,s.pageSize=parseInt(t.target.value,10),u(s)});var r=n.find("ul.pagination");r.on("click",".page-item",function(){var t=parseInt(r.find(".page-item:not(.prev):not(.next)").last().text(),10),a=$(this),e=s.pageNum;a.hasClass("prev")?s.pageNum=s.pageNum-1||1:a.hasClass("next")?s.pageNum=(s.pageNum+1)%(t+1)||t:a.hasClass("else")||(s.pageNum=parseInt(a.text(),10)||1),e!==s.pageNum&&u(s)}),t.closest(".card.result").siblings(".search").on("change",".search-box",function(){s.keyWord=$(this).val().trim()}).on("click",".search-btn",function(){u(s)}).on("keydown",".search-box",function(t){13==t.keyCode&&(s.keyWord=$(this).val().trim(),u(s))}),a.on("click","tr",function(t){var a,e,n=t.target.tagName;/tr|td/i.test(n)&&(a=$(this).closest("tr").attr("data-id"),e=$('\n          <form\n            action="fileData/fileDataDetail"\n            method="post"\n            target="_blank"\n            rel="noopener noreferrer"\n            style="display:none;"\n          >\n            <input name="fileDataId" value="'.concat(a,'" />\n            <input name="fileDataType" value="2" />\n          </form>\n        ')),$(document.body).append(e),e.submit().remove())}),a.on("click","button[data-action=star]",function(){var t=$(this),a=t.closest("tr").attr("data-id"),e=t.attr("data-toggle"),n={icon:"success",position:"bottom-right",allowToastClose:!1,stack:!1,loader:!1,hideAfter:2e3,textAlign:"center"};$.toast().reset("all"),"star"===e?f({fileDataId:a,fileDataType:2,opsFavoritesType:1},function(){t.attr({"data-toggle":"unstar",title:"取消收藏"}).children(".material-icons").text("star"),$.toast(_objectSpread({heading:"收藏成功"},n))}):"unstar"===e&&f({fileDataId:a,fileDataType:2,opsFavoritesType:2},function(){t.attr({"data-toggle":"star",title:"收藏"}).children(".material-icons").text("star_border"),$.toast(_objectSpread({heading:"已取消收藏"},n))})}).on("click","button[data-action=download]",function(){var t,a,e=$(this).closest("tr").attr("data-id"),n=$("#downloadModal"),r={fileDataId:e,fileDataType:2};t=r,a=function(t){parseInt(t.requiredIntegral,10)?(n.find(".modal-body").html('\n              使用<b class="cost"> '.concat(t.requiredIntegral,' 积分</b>下载此文件？\n              当前积分余额：<b class="remain">').concat(t.currentIntegral," 积分</b>。\n            ")),n.modal(),n.one("click","#downloadBtn",function(){i(r),n.modal("hide")})):i(r)},$.post("fileData/checkFileDownload",t,function(t){handleResult(t,a)})})}()})}();