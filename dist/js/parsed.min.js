"use strict";function _objectSpread(a){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{},n=Object.keys(e);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(e).filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.forEach(function(t){_defineProperty(a,t,e[t])})}return a}function _defineProperty(t,a,e){return a in t?Object.defineProperty(t,a,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[a]=e,t}!function(){var s={pageNum:1,pageSize:5,fileDataType:2,sortType:1,keyWord:"",classOne:0,classTwo:0,brands:[]};function l(t){var a="";t.options.map(function(t){a+='<li><a data-id="'.concat(t.id,'">').concat(t.label,"</a></li>")});return'\n      <div class="row" data-cat="'.concat(t.cat,'">\n        <div class="col-sm-2 key">\n          ').concat(t.catStr,'：\n        </div>\n        <ul class="col-sm-8 value">\n          ').concat(a,"\n        </ul>\n        ").concat(t.multi?'\n      <div class="col-sm-2 extra">\n        <a class="submit">提交</a>\n        <a class="cancel">取消</a>\n        <a class="multi">\n          <i class="material-icons">add</i>\n          多选\n        </a>\n      </div>\n    ':"","\n      </div>\n    ")}function d(t,a){var e;switch(t){case"brand":e="品牌";break;case"type":e="设备类型";break;case"subtype":e="设备次级类型";break;default:e=""}var n=a;return 7<n.length&&(n=n.substr(0,7)+"..."),'\n      <a\n        class="factor"\n        title="'.concat(a,'"\n        data-cat="').concat(t,'"\n      >\n        <b>').concat(e,"：</b>\n        <em>").concat(n,'</em>\n        <i class="material-icons">close</i>\n      </a>\n    ')}function u(t){var e=$("#table_parsed tbody");$.post("fileData/queryFileData",t,function(t){handleResult(t,function(t){e.html(""),t.list.map(function(t){var a;e.append((a={id:t.fileDataId,title:t.fileName,date:t.dataTimeDesc,size:t.fileSize+" MB",type:t.fileDataTypeDesc,cate:t.classTwoDesc,brand:t.brandDesc,company:t.enterprise,bonus:parseInt(t.requiredIntegral,10),download:t.downloadCount,fav:1===parseInt(t.favoriteStatus,10)},'\n      <tr data-id="'.concat(a.id,'">\n        <td\n          class="text-left"\n          title="').concat(a.title,'"\n        >\n          <div class="text-ellipsis">').concat(a.title,"</div>\n        </td>\n        <td>").concat(a.date,"</td>\n        <td>").concat(a.size,"</td>\n        <td>").concat(a.type,"</td>\n        <td>").concat(a.cate,"</td>\n        <td>").concat(a.brand,'</td>\n        <td title="').concat(a.company,'">').concat(a.company.substr(0,4),"</td>\n        <td>").concat(a.bonus,'</td>\n        <td class="text-right">').concat(a.download,'</td>\n        <td class="td-actions text-right">\n          <button\n            data-action="star"\n            data-toggle="').concat(a.fav?"unstar":"star",'"\n            type="button"\n            class="btn btn-warning"\n            title="').concat(a.fav?"取消":"",'收藏"\n          >\n            <i class="material-icons">star').concat(a.fav?"":"_border",'</i>\n          </button>\n          <button\n            data-action="download"\n            type="button"\n            class="btn btn-success"\n            title="下载"\n          >\n            <i class="material-icons">get_app</i>\n          </button>\n        </td>\n      </tr>\n    ')))}),function(t){var a=$("#table_parsed").siblings("nav").find("ul.pagination");a.find("li.page-item:not(.prev):not(.next)").remove();var e=a.find(".page-item.next"),n=t.pages,i=t.pageNum;if(n<=10)for(var r=1;r<=n;++r)$(c(r,i)).insertBefore(e);else i<=3?($(c(1,i)).insertBefore(e),$(c(2,i)).insertBefore(e),$(c(3,i)).insertBefore(e),$(c("...",i)).insertBefore(e)):n-2<=i?($(c(1,i)).insertBefore(e),$(c("...",i)).insertBefore(e),$(c(n-2,i)).insertBefore(e),$(c(n-1,i)).insertBefore(e)):($(c(1,i)).insertBefore(e),$(c("...",i)).insertBefore(e),$(c(i-1,i)).insertBefore(e),$(c(i,i)).insertBefore(e),$(c(i+1,i)).insertBefore(e),$(c("...",i)).insertBefore(e)),$(c(n,i)).insertBefore(e);function c(t,a){return'\n        <li class="page-item '.concat(a===t?"active":""," ").concat("..."===t?"else":"",'">\n          <a class="page-link">').concat(t,"</a>\n        </li>\n      ")}}({pageNum:t.pageNum,total:t.total,pages:t.pages})})})}function r(t,a){$.post("account/doFavorites",t,function(t){handleResult(t,a)})}$(function(){var t,a,c,e,o;t=JSON.parse(filterObjStr),a=t.BRAND.map(function(t){return{id:t.value,label:t.name}}),c=t.CLASS_ONE.map(function(t){var a=t.childrens.map(function(t){return{id:t.value,label:t.name}});return{id:t.value,label:t.name,children:a}}),e=$(".filter .combine"),(o=$(".filter .condition")).html("").append(l({cat:"brand",catStr:"品牌",options:a,multi:!0})).append(l({cat:"type",catStr:"设备类型",options:c,multi:!1})),e.on("click",".factor",function(){var t=$(this),a=t.attr("data-cat");switch(o.children(".row[data-cat=".concat(a,"]")).show(),t.remove(),a){case"brand":s.brands=[];break;case"type":s.classOne=0,s.classTwo=0,t.siblings('[data-cat="subtype"]').remove(),o.find('[data-cat="subtype"]').remove();break;case"subtype":s.classTwo=0;break;default:return}u(s)}).on("click",".reset",function(){o.children(".row[data-cat]").show().filter('[data-cat="subtype"]').remove(),e.children(".factor").remove(),s.brands=[],s.classOne=0,s.classTwo=0,u(s)}),o.on("click",".row:not(.multi) .value a",function(){var t=$(this),a=t.closest(".row[data-cat]"),e=a.attr("data-cat"),n=t.text();switch($(d(e,n)).insertBefore(".filter .combine .reset"),a.hide(),e){case"brand":s.brands=[parseInt(t.attr("data-id"),10)];break;case"type":var i=parseInt(t.attr("data-id"),10);s.classOne=i;var r=c.find(function(t){return t.id===i});r.children.length&&o.append(l({cat:"subtype",catStr:"设备次级类型",options:r.children,multi:!1}));break;case"subtype":s.classTwo=parseInt(t.attr("data-id"),10);break;default:return}u(s)}).on("click",".row.multi .value li",function(){var t=$(this);t.closest("li").toggleClass("active")}).on("click",".extra .multi",function(){var t=$(this);t.closest(".row[data-cat]").addClass("multi")}).on("click",".extra .submit",function(){var t=$(this),a=t.closest(".row.multi[data-cat]"),e=a.find(".value li.active"),n=a.attr("data-cat"),i="",r=[];e.text(function(t,a){i+=(t?",":"")+a;var e=$(this).find("a");r.push(parseInt(e.attr("data-id"),10))}),i&&($(d(n,i)).insertBefore(".filter .combine .reset"),a.hide(),s.brands=r,u(s)),a.removeClass("multi"),e.removeClass("active")}).on("click",".extra .cancel",function(){var t=$(this),a=t.closest(".row.multi[data-cat]"),e=a.find(".value li.active");a.removeClass("multi"),e.removeClass("active")}),function(){var t=$("#table_parsed"),a=t.find("tbody");u(s);var e=t.find("a[data-rank]");e.on("click",function(){var t=$(this),a=t.attr("data-rank");"none"===a&&(e.attr("data-rank","none").children("i").removeClass("rank-desc").removeClass("rank-asc"),t.attr("data-rank","desc").children("i").addClass("rank-desc"),s.sortType=t.attr("data-type"),u(s))});var n=t.siblings("nav");n.find(".limit select").on("change",function(t){s.pageNum=1,s.pageSize=parseInt(t.target.value,10),u(s)});var i=n.find("ul.pagination");i.on("click",".page-item",function(){var t=parseInt(i.find(".page-item:not(.prev):not(.next)").last().text(),10),a=$(this),e=s.pageNum;a.hasClass("prev")?s.pageNum=s.pageNum-1||1:a.hasClass("next")?s.pageNum=(s.pageNum+1)%(t+1)||t:a.hasClass("else")||(s.pageNum=parseInt(a.text(),10)||1),e!==s.pageNum&&u(s)}),t.closest(".card.result").siblings(".search").on("change",".search-box",function(){s.keyWord=$(this).val().trim()}).on("click",".search-btn",function(){u(s)}).on("keydown",".search-box",function(t){13==t.keyCode&&(s.keyWord=$(this).val().trim(),u(s))}),a.on("click","tr",function(t){var a=t.target.tagName;if(/tr|td/i.test(a)){var e=$(this).closest("tr").attr("data-id"),n=$('\n          <form\n            action="fileData/fileDataDetail"\n            method="post"\n            target="_blank"\n            rel="noopener noreferrer"\n            style="display:none;"\n          >\n            <input name="fileDataId" value="'.concat(e,'" />\n            <input name="fileDataType" value="2" />\n          </form>\n        '));$(document.body).append(n),n.submit().remove()}}),a.on("click","button[data-action=star]",function(){var t=$(this),a=t.closest("tr"),e=a.attr("data-id"),n=t.attr("data-toggle"),i={icon:"success",position:"bottom-right",allowToastClose:!1,stack:!1,loader:!1,hideAfter:2e3,textAlign:"center"};$.toast().reset("all"),"star"===n?r({fileDataId:e,fileDataType:2,opsFavoritesType:1},function(){t.attr({"data-toggle":"unstar",title:"取消收藏"}).children(".material-icons").text("star"),$.toast(_objectSpread({heading:"收藏成功"},i))}):"unstar"===n&&r({fileDataId:e,fileDataType:2,opsFavoritesType:2},function(){t.attr({"data-toggle":"star",title:"收藏"}).children(".material-icons").text("star_border"),$.toast(_objectSpread({heading:"已取消收藏"},i))})}).on("click","button[data-action=download]",function(){var t,a,e=$(this).closest("tr").attr("data-id"),n=$("#downloadModal");t={fileDataId:e,fileDataType:2},a=function(t){n.find(".modal-body").html('\n            使用<b class="cost"> '.concat(t.requiredIntegral,' 积分</b>下载此文件？\n            当前积分余额：<b class="remain">').concat(t.currentIntegral," 积分</b>。\n          ")),n.modal(),n.on("click","#downloadBtn",function(){var t,a;t={fileDataId:e,fileDataType:2},a=$("base").attr("href")+"fileData/doFileDownload",$.fileDownload(a,{httpMethod:"POST",data:t}),n.modal("hide")})},$.post("fileData/checkFileDownload",t,function(t){handleResult(t,a)})})}()})}();